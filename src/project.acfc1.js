window.__require=function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){return o(t[s][1][e]||e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({Astar:[function(e,t,i){"use strict";cc._RF.push(t,"7b5d59O2xRJPLvP32T7QogL","Astar");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t,i,n){o(this,e),this.parentNode=n,this.position=t,this.gValue=n?n.getGValue()+1:0,this.fValue=this.gValue+i}return n(e,[{key:"getParentNode",value:function(){return this.parentNode}},{key:"getPosition",value:function(){return this.position}},{key:"getGValue",value:function(){return this.gValue}},{key:"getFValue",value:function(){return this.fValue}},{key:"equal",value:function(e){return this.position.x==e.x&&this.position.y==e.y}},{key:"add",value:function(e){return{x:this.position.x+e.x,y:this.position.y+e.y}}}]),e}(),s=[{x:0,y:1},{x:0,y:-1},{x:-1,y:0},{x:1,y:0}],a=function(){function e(){o(this,e)}return n(e,[{key:"estimateHValue",value:function(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}},{key:"contain",value:function(e){return this.activeNodes[e.y*this.map[0].length+e.x]}},{key:"isEmptyPlace",value:function(e){if(this.map[e.y]){var t=this.map[e.y][e.x];return!!t&&0!==t}return!1}},{key:"activedNode",value:function(e){this.activeNodes[e.y*this.map[0].length+e.x]=!0}},{key:"addSquareNode",value:function(e,t){var i=this;if(e){this.activedNode(e.getPosition());var n=null;s.forEach(function(o){n=e.add(o),!i.contain(n)&&i.isEmptyPlace(n)&&(i.activedNode(n),i.openList.push(new r(n,i.estimateHValue(n,t),e)))}),this.openList.sort(function(e,t){return e.getFValue()==t.getFValue()?t.getGValue()-e.getGValue():e.getFValue()-t.getFValue()})}}},{key:"makePath",value:function(e,t){var i=this.estimateHValue(e,t);if(0!=i){this.openList=[],this.activeNodes={};var n=[],o=new r(e,i,null);this.openList.push(o);for(var s=null;this.openList.length>0;){if((o=this.openList.shift()).equal(t)){s=o;break}this.addSquareNode(o,t)}for(;s;)n.push(s),s=s.getParentNode();return n.reverse(),n}}},{key:"getPath",value:function(e,t,i){return this.map=e,this.makePath(t,i)}}]),e}();t.exports=a,cc._RF.pop()},{}],UserInfo:[function(e,t,i){"use strict";cc._RF.push(t,"96f5bN070FOiImUbvAsL+lx","UserInfo"),Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e("settingMgr"),s=function(){function e(){o(this,e),this.initDefault(),cc.log("constructor")}return n(e,[{key:"initDefault",value:function(){var e=r.getSetting("constant"),t=e.getValue("INIT_COIN_NUM"),i=e.getValue("INIT_DIAMOND_NUM");return this._userInfo={},this._userInfo.stage=1,this._userInfo.coin=parseInt(t),this._userInfo.diamond=parseInt(i),this._userInfo.techInfo={},this._userInfo.buyRecord=[],this._userInfo.packageRecord=[],this._userInfo.towerBuildingRecord=[],this._userInfo.candyBagRecord={},this._userInfo.maxBuildingLevel=1,this.initCandyBagRecord(),this.initTechInfo(),this.initBuyRecord(),this.initSecretBoxRecord(),cc.log("initDefault "+JSON.stringify(this._userInfo)),this._userInfo}},{key:"initCandyBagRecord",value:function(){this._userInfo.candyBagRecord={},this._userInfo.candyBagRecord.timeStamp=0,this._userInfo.candyBagRecord.takeTimes=0}},{key:"initTechInfo",value:function(){var e=this,t=r.getSetting("science").getScienceList();Object.values(t).forEach(function(t){var i={};i.id=t.id,i.level=t.sciLvlArray[0].level,e._userInfo.techInfo[i.id]=i})}},{key:"initBuyRecord",value:function(){var e=this,t=r.getSetting("buildingLevel").getInfoMap();Object.values(t).forEach(function(t){var i={};i.id=t.id,i.num=0,e._userInfo.buyRecord.push(i)})}},{key:"initSecretBoxRecord",value:function(){this._userInfo.secretBoxRecord={},this._userInfo.secretBoxRecord.state=0,this._userInfo.secretBoxRecord.timeStamp=0,this._userInfo.secretBoxRecord.coin=0}},{key:"getStage",value:function(){return this._userInfo.stage}},{key:"setStage",value:function(e){e=e||1,this._userInfo.stage=e}},{key:"getCoin",value:function(){return this._userInfo.coin}},{key:"setCoin",value:function(e){var t=r.getSetting("constant").getValue("COIN_MAX");this._userInfo.coin=e>t?t:e}},{key:"isCoinEnough",value:function(e){return this._userInfo.coin>=e}},{key:"getDiamond",value:function(){return this._userInfo.diamond}},{key:"setDiamond",value:function(e){var t=r.getSetting("constant").getValue("DIAMOND_MAX");this._userInfo.diamond=e>t?t:e}},{key:"getCandyBagRecord",value:function(){return this._userInfo.candyBagRecord}},{key:"setCandyBagRecord",value:function(e){this._userInfo.candyBagRecord=e}},{key:"getSecretBoxRecord",value:function(){return this._userInfo.secretBoxRecord}},{key:"setSecretBoxRecord",value:function(e){this._userInfo.secretBoxRecord=e}},{key:"getMaxBuildingLevel",value:function(){return this._userInfo.maxBuildingLevel}},{key:"setMaxBuildingLevel",value:function(e){this._userInfo.maxBuildingLevel=e}},{key:"setTowerBuildingRecord",value:function(e){this._userInfo.towerBuildingRecord=e}},{key:"getTowerBuildingRecord",value:function(){return this._userInfo.towerBuildingRecord}},{key:"setPackageRecord",value:function(e){this._userInfo.packageRecord=e}},{key:"getPackageRecord",value:function(){return this._userInfo.packageRecord}},{key:"setUserInfo",value:function(e){this._userInfo.stage=e.stage,this._userInfo.coin=e.coin,this._userInfo.diamond=e.diamond,this._userInfo.techInfo=e.techInfo,this._userInfo.buyRecord=e.buyRecord,this._userInfo.packageRecord=e.packageRecord,this._userInfo.towerBuildingRecord=e.towerBuildingRecord,this._userInfo.maxBuildingLevel=e.maxBuildingLevel,this._userInfo.candyBagRecord=e.candyBagRecord,this._userInfo.secretBoxRecord=e.secretBoxRecord}},{key:"getTechInfoList",value:function(){return this._userInfo.techInfo}},{key:"getTechInfo",value:function(e){return this._userInfo.techInfo[e]}},{key:"getBuyRecord",value:function(e){for(var t=0;t<this._userInfo.buyRecord.length;t++){var i=this._userInfo.buyRecord[t];if(i.id===e)return i}return null}},{key:"setBuyRecord",value:function(e,t){for(var i=0;i<this._userInfo.buyRecord.length;i++){var n=this._userInfo.buyRecord[i];if(n.id===e){n.num=t;break}}}}],[{key:"getSingleton",value:function(){return this._userInfo||(this._userInfo=new e),this._userInfo}}]),e}();i.default=s,t.exports=i.default,cc._RF.pop()},{settingMgr:"settingMgr"}],buffSetting:[function(e,t,i){"use strict";cc._RF.push(t,"cac47T6iqdMX5HqHZ/6VL0M","buffSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e("constant").BuffType,s=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};if(e.id){switch(i.id=e.id,e.type){case 1:i.type=r.Weight;break;case 2:i.type=r.Speed;break;case 3:i.type=r.Attack;break;case 4:i.type=r.AttackInterval;break;default:cc.assert(!1," invalid buff type: "+i.type)}i.value=e.value,i.duration=e.duration,i.prefab=e.prefab,t._infoMap[i.id]=i}})}},{key:"getBuffInfo",value:function(e){return this._infoMap[e]}}]),e}();t.exports=s,cc._RF.pop()},{constant:"constant"}],buildingController:[function(e,t,i){"use strict";cc._RF.push(t,"6a759bYX7lPrItmCFZeonjv","buildingController");var n=e("settingMgr"),o=e("helper"),r=e("objectFactory");cc.Class({extends:cc.Component,properties:{buildingSprite:cc.Sprite,baseNode:cc.Node},stopAttack:function(){this.attackMode=!1},startAttack:function(){this.attackMode=!0},onLoad:function(){this.isPlaced=!1,this.canPlace=!0,this.attackHurtRate=1,this.attackMode=!1,this.warningNode=null},start:function(){this.timer=0},setAttackHurtRate:function(e){this.attackHurtRate=e},getBuildingPrefabName:function(){return this.buildingAttr.prefab},getAttackRange:function(){return this.buildingAttr.attRange},getSpriteFrame:function(){return this.buildingSprite.spriteFrame},init:function(e,t){var i=n.getSetting("building"),r=n.getSetting("bullet"),s=i.getBuildingInfo(e);cc.assert(s);var a=r.getBulletInfo(s.bullet),c=cc.loader.getRes("bulletPrefab/"+a.prefab,cc.Prefab);cc.assert(c),this.buildingAttr=s,this.bulletAttr=a,this.bulletPrefab=c,this.towerController=t,this.canShoot=!0,this.schedule(this.resetCoolDown,this.buildingAttr.attInterval),this.attackMode=!0,this.isPlaced=!0,this.lastShootTime=0,this.attackIntervalFix=1;var l=n.getSetting("constant").getValue("BUILDING_ACC_COEF");this.attackFixValue=l;var u=n.getSetting("constant");this.moneyGenInterval=u.getValue("BUILDING_OUTPUT_INTERVAL");var h=o.random(1,1e3*this.moneyGenInterval);this.randomInterval=h/1e3,this.schedule(this.autoMoney,this.randomInterval),this.node.zIndex=-Math.floor(this.node.position.y)},autoMoney:function(){if(this.randomInterval!==this.moneyGenInterval&&(this.randomInterval=this.moneyGenInterval,this.unschedule(this.autoMoney),this.schedule(this.autoMoney,this.moneyGenInterval)),0!==this.buildingID){var e=n.getSetting("buildingLevel").getBuildingLevelInfo(this.buildingAttr.level),t=this.node.getComponent(cc.BoxCollider),i=this.node.parent.convertToWorldSpaceAR(this.node.position.addSelf(t.offset));i.y+=this.node.height/2;var o=Math.floor(e.addGold*this.moneyGenInterval);this.towerController.uiController.generateAutoMoneyTip(i,o),this.towerController.userController.addCoin(o,!1)}},showGreenBase:function(){var e=this.node.getComponent(cc.BoxCollider);this.baseNode.setContentSize(e.size),this.baseNode.setPosition(e.offset),this.baseNode.active=!0,this.baseNode.opacity=155,this.baseNode.color=cc.Color.BLACK.fromHEX("#4ee498")},showRedBase:function(){var e=this.node.getComponent(cc.BoxCollider);this.baseNode.setContentSize(e.size),this.baseNode.setPosition(e.offset),this.baseNode.active=!0,this.baseNode.opacity=155,this.baseNode.color=cc.Color.BLACK.fromHEX("#fc3d3d")},hideBase:function(){this.baseNode.active=!1},showAttackRange:function(e){if(this.rangeNode)this.rangeNode.active=!0;else{var t=this.node.getComponent(cc.BoxCollider),i=cc.loader.getRes("buildingPrefab/circle",cc.Prefab);this.rangeNode=new cc.instantiate(i),this.rangeNode.position=this.rangeNode.position.addSelf(t.offset),this.rangeNode.setContentSize(cc.size(2*e,2*e)),this.rangeNode.parent=this.node,this.rangeNode.color=cc.Color.BLACK.fromHEX("#fc3d3d")}},changeAttackRangeGreen:function(){this.rangeNode&&(this.rangeNode.color=cc.Color.BLACK.fromHEX("#4ee498"))},changeAttackRangeRed:function(){this.rangeNode&&(this.rangeNode.color=cc.Color.BLACK.fromHEX("#fc3d3d"))},hideAttackRange:function(){this.rangeNode&&this.rangeNode.destroy()},showWarning:function(){if(!this.warningNode){var e=this.node.getComponent(cc.BoxCollider),t=cc.loader.getRes("effectPrefab/warning",cc.Prefab);cc.assert(t);var i=cc.instantiate(t);i.parent=this.node,i.position=i.position.addSelf(e.offset),this.warningNode=i}this.warningNode.active=!0},hideWarning:function(){this.warningNode&&(this.warningNode.active=!1)},playWarningAnimation:function(){this.showWarning(),this.warningNode.getComponent(cc.Animation).play()},hide:function(){this.node.active=!1},show:function(){this.node.active=!0},getBuildingID:function(){return this.buildingAttr.id},getBuildingLevel:function(){return this.buildingAttr.level},resetCoolDown:function(){this.canShoot=!0},update:function(e){this.timer+=e,this.attackMode&&this.checkEnemyInRange()},isCanPlace:function(){return this.canPlace},checkEnemyInRange:function(){var e=this;null!=this.towerController&&this.towerController.enemyOnRoad.forEach(function(t){if(!(0!==e.lastShootTime&&e.timer-e.lastShootTime<e.buildingAttr.attInterval*e.attackIntervalFix||t.isFeedFull())){var i=t.node;if(o.calDistance(i.position,e.node.position)<=e.buildingAttr.attRange){var n=r.getObject(e.bulletPrefab);n.position=e.node.position,n.parent=e.towerController.bulletLayer;var s=n.getComponent("bulletController"),a=o.genID();s.init(a,e.buildingAttr.bullet,i,(e.buildingAttr.attack*e.attackHurtRate).toFixed(2),e.towerController),1!==e.attackIntervalFix&&e.playSpeedAttackAnim(),e.towerController.bulletMap[a]=s,e.lastShootTime=e.timer}}})},onCollisionEnter:function(e,t){if("buildingBase"==e.node.group||"roadTile"==e.node.group||"wall"==e.node.group){var i=t.getComponent("buildingController");i.isPlaced||(i.showRedBase(),i.changeAttackRangeRed(),this.canPlace=!1)}else"speedDetect"==e.node.group&&(this.attackIntervalFix=this.attackFixValue,this.node.runAction(cc.scaleBy(.1,1.2)))},playSpeedAttackAnim:function(){this.node.runAction(cc.sequence(cc.scaleTo(.1,1),cc.scaleBy(.2,1.2)))},onCollisionStay:function(e,t){if("buildingBase"==e.node.group||"roadTile"==e.node.group||"wall"==e.node.group){var i=t.getComponent("buildingController");i.isPlaced||(i.showRedBase(),i.changeAttackRangeRed(),this.canPlace=!1)}else"speedDetect"===e.node.group&&(this.attackIntervalFix=this.attackFixValue)},onCollisionExit:function(e,t){if("buildingBase"==e.node.group||"roadTile"==e.node.group||"wall"==e.node.group){var i=t.getComponent("buildingController");i.isPlaced||(i.showGreenBase(),i.changeAttackRangeGreen(),this.canPlace=!0)}else"speedDetect"===e.node.group&&(this.node.stopAllActions(),this.attackIntervalFix=1,this.node.runAction(cc.scaleTo(.1,1)))}}),cc._RF.pop()},{helper:"helper",objectFactory:"objectFactory",settingMgr:"settingMgr"}],buildingLevelSetting:[function(e,t,i){"use strict";cc._RF.push(t,"be095CIfJdC1qFidAMuTvel","buildingLevelSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};e.id&&(i.id=e.id,i.buyPrice=e.buyGold,i.refreshPrice=e.refreshGold,i.addGold=e.addGold,t._infoMap[i.id]=i)})}},{key:"getBuildingLevelInfo",value:function(e){return this._infoMap[e]}},{key:"getInfoMap",value:function(){return this._infoMap}}]),e}();t.exports=r,cc._RF.pop()},{}],buildingPanelController:[function(e,t,i){"use strict";cc._RF.push(t,"88b11FOLHpOVJNB829X6Dxy","buildingPanelController");var n=e("settingMgr");e("helper");cc.Class({extends:cc.Component,properties:{text:cc.Label,buildingIcon:cc.Sprite},onLoad:function(){},updateInfo:function(e){var t=n.getSetting("building").getBuildingInfo(e);if(t){cc.loader.getRes("buildingPrefab/"+t.prefab,cc.Prefab);this.setSpriteFrame(this.buildingIcon,t.prefab);var i=n.getSetting("text").getText("10011");i=(i=i.replace("$[arg1]",t.name)).replace("$[arg2]",t.level),this.text.string=i}else console.error("buildingPanelController updateInfo error buildingInfo not exist id= ",e)},setSpriteFrame:function(e,t){var i="sprite/building/";i+=t.replace("building_","");var n=cc.loader.getRes(i,cc.SpriteFrame);e.spriteFrame=n},share:function(){cc.log("buildingPanelController Share"),this.close()},close:function(){this.node.active=!1}}),cc._RF.pop()},{helper:"helper",settingMgr:"settingMgr"}],buildingSetting:[function(e,t,i){"use strict";cc._RF.push(t,"f83bcxnFZVMSqrZIL8ziDZ8","buildingSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._buldingInfoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;cc.assert(Array.isArray(e)),e.forEach(function(e){var i={};e.id&&(i.id=e.id,i.level=e.level,i.name=e.name,i.description=e.description,i.attack=e.attack,i.attRange=e.attRange,i.attInterval=e.attInterval,i.bullet=e.bullet,i.prefab=e.prefab,i.sciLvl=e.sciLvl,i.next=e.nextBuilding,i.type=e.type,i.attRangeText=e.attRangeText,i.attIntervalText=e.attIntervalText,t._buldingInfoMap[i.id]=i)})}},{key:"getBuildingInfo",value:function(e){return this._buldingInfoMap[e]}}]),e}();t.exports=r,cc._RF.pop()},{}],buildingTipController:[function(e,t,i){"use strict";cc._RF.push(t,"4087fPK1bhNt7jkn1CRpEWx","buildingTipController");var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,a=r.property,c=e("../setting/settingMgr"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buildingTypeIconArray=[],t.icon=null,t.nameLabel=null,t.lvLabel=null,t.desc=null,t.attackLabel=null,t.intervalLabel=null,t.rangeLabel=null,t}return n(t,e),t.prototype.setInfo=function(e){var t=c.getSetting("building").getBuildingInfo(e);this.icon.spriteFrame=this.buildingTypeIconArray[t.type-1],this.nameLabel.string=t.name,this.lvLabel.string=t.level.toString(),this.desc.string=t.description,this.attackLabel.string=t.attack.toString(),this.intervalLabel.string=t.attIntervalText,this.rangeLabel.string=t.attRangeText},t.prototype.setActive=function(){this.node.x=0},t.prototype.setInactive=function(){this.node.x=-9999},o([a(cc.SpriteFrame)],t.prototype,"buildingTypeIconArray",void 0),o([a(cc.Sprite)],t.prototype,"icon",void 0),o([a(cc.Label)],t.prototype,"nameLabel",void 0),o([a(cc.Label)],t.prototype,"lvLabel",void 0),o([a(cc.Label)],t.prototype,"desc",void 0),o([a(cc.Label)],t.prototype,"attackLabel",void 0),o([a(cc.Label)],t.prototype,"intervalLabel",void 0),o([a(cc.Label)],t.prototype,"rangeLabel",void 0),t=o([s],t)}(cc.Component);i.default=l,cc._RF.pop()},{"../setting/settingMgr":"settingMgr"}],bulletController:[function(e,t,i){"use strict";cc._RF.push(t,"7de2ddXkhZKS6e9os3oBtUs","bulletController");var n=e("helper"),o=e("settingMgr");cc.Class({extends:cc.Component,init:function(e,t,i,n,r){var s=o.getSetting("bullet").getBulletInfo(t);cc.assert(s),this.id=e,this.bulletAttr=s,this.bulletType=s.type,this.hurt=n,this.target=i,this.targetController=i.getComponent("enemyController"),this.towerController=r,this.hit=!1,this.buff=s.buff,this.buffPosibility=s.buffPosibility},update:function(e){var t=n.getVectorRad(this.node.position,this.targetController.getHitPoint()),i=cc.misc.radiansToDegrees(t);this.node.angle=i,this.node.position=n.getPointOnCycle(t,this.bulletAttr.speed*e,this.node.position)}}),cc._RF.pop()},{helper:"helper",settingMgr:"settingMgr"}],bulletSetting:[function(e,t,i){"use strict";cc._RF.push(t,"130a0uLQ91O44e3YHMbP4aj","bulletSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=e("constant").BulletType,s=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};if(e.id){i.id=e.id;var n=e.type;switch(n){case 1:i.type=r.Normal;break;case 2:i.type=r.Range;break;default:cc.assert(!1," invalid bullet type: "+n)}i.speed=e.speed,i.prefab=e.prefab,i.explodePrefab=e.explodePrefab,i.buff=e.buff,i.buffPosibility=e.buffProb,t._infoMap[i.id]=i}})}},{key:"getBulletInfo",value:function(e){return this._infoMap[e]}}]),e}();t.exports=s,cc._RF.pop()},{constant:"constant"}],candyBagController:[function(e,t,i){"use strict";cc._RF.push(t,"d3526DkbtFN3bC7YXDecOrh","candyBagController");var n=e("userController"),o=e("uiController"),r=e("settingMgr"),s=e("helper");cc.Class({extends:cc.Component,properties:{userController:n,diamond:cc.Label,getTimeText:cc.RichText,uiController:o},onEnable:function(){var e=r.getSetting("constant"),t=r.getSetting("stages");this.maxTimes=e.getValue("AD_GET_DIAMOND_TIMES"),this.stage=this.userController.getStage(),this.info=t.getStageInfo(this.stage);var i=this.userController.getCandyBagRecord(),n="<b>\u4eca\u65e5\u8fd8\u53ef\u5f00\u542f "+(this.maxTimes-i.takeTimes)+" / "+this.maxTimes+" \u6b21 < /b>";this.getTimeText.string=n,this.diamond.string=""+this.info.diamondBox},get:function(){var e=this.userController.getCandyBagRecord();if(s.isToday(e.timeStamp)){if(this.maxTimes<=e.takeTimes)return void this.uiController.generateTip("10005");e.takeTimes++}else e.timeStamp=s.nowUnixSec(),e.takeTimes=1;this.userController.setCandyBagRecord(e),this.userController.saveUserInfo(),this.userController.addDiamond(this.info.diamondBox);var t="<b>\u4eca\u65e5\u8fd8\u53ef\u5f00\u542f "+(this.maxTimes-e.takeTimes)+" / "+this.maxTimes+" \u6b21 < /b>";this.getTimeText.string=t;var i=[];i.push(this.info.diamondBox),this.uiController.generateTip("10001",i)},close:function(){this.node.active=!1}}),cc._RF.pop()},{helper:"helper",settingMgr:"settingMgr",uiController:"uiController",userController:"userController"}],combineController:[function(e,t,i){"use strict";cc._RF.push(t,"30e66wzJXVEease06FPxOl2","combineController");(function(e){e&&e.__esModule})(e("../util/UserInfo"));var n=e("../util/musicPlayer");var o=e("settingMgr"),r=e("helper"),s=e("userController"),a=e("constant"),c=a.Event,l=e("uiController");cc.Class({extends:cc.Component,properties:{uiController:l,userController:s,shopSlotSprite:cc.Sprite,shopSlotLevelLabel:cc.Label,buyPriceLabel:cc.Label,refreshPriceLabel:cc.Label,techTab:cc.Node,buildingTab:cc.Node,techItemPrefab:cc.Prefab,listNode:cc.Node,gridNode:cc.Node,recycleNode:cc.Node,slotPrefab:cc.Prefab,slotCount:cc.Integer,refreshButton:cc.Node,techTabToggle:cc.Toggle,buildingTabToggle:cc.Toggle},initEvent:function(){this.node.on(c.TechInfoChange,this.techInfoChange,this),this.node.on(c.StageChange,this.stageChange,this)},init:function(e){var t=this,i=o.getSetting("building");this.allBuildingList=[],Object.values(i._buldingInfoMap).forEach(function(e){t.allBuildingList.push(e)}),this.shopBuildingInfo=null,this.shopBuildingLevelInfo=null,this.initSlots(e),this.initScienceTab(e),this.initButton(e),this.initEvent(),this.updateShop()},initButton:function(e){o.getSetting("constant")},savePacakgeRecord:function(){var e=[];this.slotControllers.forEach(function(t){var i={};i.buildingID=t.getSlotBuildingID(),e.push(i)}),this.userController.setPackageRecord(e)},stageChange:function(e){this.initScienceTab(e),this.initButton(e)},initScienceTab:function(e){var t=o.getSetting("constant").getValue("TECH_OPEN_STAGE_NUM");if(!(this.userController.getStage()<t)){var i=this.userController.getTechInfoList(),n=o.getSetting("science").getScienceList();this.listNode.removeAllChildren(),this.techItemControllers=[];for(var r=null,s=0;s<n.length;s++){var a=i[n[s].id];if(!a)return void cc.assert("error");r=cc.instantiate(this.techItemPrefab),this.listNode.addChild(r);var c=r.getComponent("techItemController");c.init(a.id,a.level,this.userController,this.uiController),this.techItemControllers.push(c)}}},techInfoChange:function(){for(var e=0;e<this.techItemControllers.length;e++){this.techItemControllers[e].updateInfoCondition()}},initSlots:function(e){this.slotControllers=[];for(var t=null,i=0;i<this.slotCount;i++){(t=cc.instantiate(this.slotPrefab)).active=!0,t.name=t.name+i,t.parent=this.gridNode;var n=t.getComponent("slotController");n.init(i,this.uiController,this.userController,this),this.slotControllers.push(n);var o=this.userController.getPackageRecord();o[i]&&n.updateInfo(o[i].buildingID)}},priceFix:function(e,t){var i=o.getSetting("constant"),n=i.getValue("BUYTIMES_COEF_A"),r=i.getValue("BUYTIMES_COEF_B"),s=i.getValue("BUYTIMES_COEF_C");return Math.floor(e*(t*t*n+t*r+s))},buy:function(){var e=this.shopBuildingLevelInfo.buyPrice,t=this.userController.getBuyRecord(this.shopBuildingLevelInfo.id);if(e=this.priceFix(e,t.num),this.userController.isCoinEnough(e))for(var i=0;i<this.slotControllers.length;i++){var o=this.slotControllers[i];if(o.isEmpty()){this.userController.reduceCoin(e),o.updateInfo(this.shopBuildingInfo.id),this.userController.addBuyRecord(t.id,1),this.updateShop(),this.savePacakgeRecord(),n.MusicPlayer.playEffectBuy();break}i===this.slotControllers.length-1&&this.uiController.generateTip("10201")}else this.coinNotEnough()},refresh:function(){var e=o.getSetting("constant").getValue("REFRESH_OPEN_STAGE_NUM");if(this.userController.getStage()<e){var t=[];return t.push(e),void this.uiController.generateTip("10201",t)}var i=this.shopBuildingLevelInfo.refreshPrice,n=this.userController.getBuyRecord(this.shopBuildingLevelInfo.id);i=this.priceFix(i,n.num),this.userController.isCoinEnough(i)&&(this.userController.reduceCoin(i),this.updateShop())},updateShop:function(){for(var e=o.getSetting("buildingLevel"),t=this.userController.getTechInfo(3),i=this.userController.getTechInfo(4),n=o.getSetting("science"),s=n.getScienceLevelInfo(t.id,t.level),a=n.getScienceLevelInfo(i.id,i.level),c=[],l=0;l<this.allBuildingList.length;l++){var u=this.allBuildingList[l];u.level>=s.value&&u.level<=a.value&&c.push(u)}var h=c[r.random(0,c.length)],d=e.getBuildingLevelInfo(h.level);this.shopBuildingInfo=h,this.shopBuildingLevelInfo=d,this.shopSlotLevelLabel.string=h.level,this.setSpriteFrame(this.shopSlotSprite,h.prefab);var g=this.userController.getBuyRecord(this.shopBuildingLevelInfo.id);this.buyPriceLabel.string=r.numToStringWithUnit(this.priceFix(d.buyPrice,g.num))},setSpriteFrame:function(e,t){var i="sprite/building/"+t;i=i.replace("building_","");var n=cc.loader.getRes(i,cc.SpriteFrame);n?(e.spriteFrame=n,r.sprResizeByScale(e,60)):console.error("SpriteFrame not found, url: "+i)},getTouchSlotGrid:function(e){e=this.gridNode.convertToNodeSpaceAR(e);for(var t=0;t<this.slotControllers.length;t++)if(this.slotControllers[t].node.getBoundingBox().contains(e))return this.slotControllers[t];return null},isTouchRecycleButtton:function(e){return e=this.node.convertToNodeSpaceAR(e),!!this.recycleNode.getBoundingBox().contains(e)},getSlotController:function(e){return this.slotControllers[e]},clickTabBuilding:function(){this.buildingTab.active=!0,this.techTab.active=!1},clickTabTech:function(){var e=o.getSetting("constant").getValue("TECH_OPEN_STAGE_NUM");if(this.userController.getStage()<e){this.buildingTabToggle.isChecked=!0,this.techTabToggle.isChecked=!1;var t=[];return t.push(e),void this.uiController.generateTip("10101",t)}this.techTab.active=!0,this.buildingTab.active=!1},isBuildingTab:function(){return this.buildingTab.active},isNewBuilding:function(e){var t=o.getSetting("building").getBuildingInfo(e).level;return t>this.userController.getMaxBuildingLevel()&&(this.userController.setMaxBuildingLevel(t),!0)},putBackBuilding:function(e){for(var t=0;t<this.slotControllers.length;t++){var i=this.slotControllers[t];if(i.isEmpty()){i.updateInfo(e);break}}},shineIfSameID:function(e){this.slotControllers.forEach(function(t){t.shineIfSameID(e)})},stopShine:function(){this.slotControllers.forEach(function(e){e.stopShine()})},recycleBuilding:function(e){var t=o.getSetting("buildingLevel"),i=o.getSetting("constant"),r=t.getBuildingLevelInfo(e),s=i.getValue("BUILDING_SELL_COEF"),a=Math.floor(s*r.buyPrice);this.userController.addCoin(a),n.MusicPlayer.playEffectSale()},setRecyclePriceShow:function(e){var t=o.getSetting("buildingLevel"),i=o.getSetting("constant"),n=t.getBuildingLevelInfo(e),s=i.getValue("BUILDING_SELL_COEF"),a=Math.floor(s*n.buyPrice);this.recycleNode.getChildByName("price").active=!0,this.recycleNode.getChildByName("price").getComponent(cc.Label).string=r.numToStringWithUnit(a)},clearRecyclePriceShow:function(){this.recycleNode.getChildByName("price").active=!1,this.recycleNode.getChildByName("price").getComponent(cc.Label).string=""},coinNotEnough:function(){this.uiController.generateTip("10003");var e=this.userController.getSecretBoxRecord();e.state>=a.SecretBoxState.Active&&this.uiController.showSecretBox(e.state)}}),cc._RF.pop()},{"../util/UserInfo":"UserInfo","../util/musicPlayer":"musicPlayer",constant:"constant",helper:"helper",settingMgr:"settingMgr",uiController:"uiController",userController:"userController"}],combineEffectController:[function(e,t,i){"use strict";cc._RF.push(t,"ca913wPdClK7atKNVsC+PfP","combineEffectController");var n=e("objectFactory"),o=e("constant"),r=e("helper"),s=o.Event;cc.Class({extends:cc.Component,properties:{buildingLeft:cc.Sprite,buildingRight:cc.Sprite},onLoad:function(){this.anim=this.node.getComponent(cc.Animation),this.anim.on("finished",this.onAnimationFinished,this)},init:function(e,t,i){this.buildingLeft.spriteFrame=e,this.buildingRight.spriteFrame=t,r.sprResizeByScale(this.buildingLeft,100),r.sprResizeByScale(this.buildingRight,100),this.parentNode=i,this.anim.play()},onAnimationFinished:function(){var e=cc.loader.getRes("effectPrefab/effect_merge2",cc.Prefab);cc.assert(e);var t=n.getObject(e),i=cc.Canvas.instance.node;t.parent=i,t.position=i.convertToNodeSpaceAR(this.node.parent.convertToWorldSpaceAR(this.node.position)),t.getComponent("onAnimationFinish").play(),n.putObject(this.node),this.parentNode.emit(s.CombineFinish)}}),cc._RF.pop()},{constant:"constant",helper:"helper",objectFactory:"objectFactory"}],constantSetting:[function(e,t,i){"use strict";cc._RF.push(t,"cc9c65ZPExECJ/ik9KEZJJn","constantSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};e.id&&(i.id=e.id,i.value=e.value,t._infoMap[i.id]=i)})}},{key:"getValue",value:function(e){return this._infoMap[e].value}}]),e}();t.exports=r,cc._RF.pop()},{}],constant:[function(e,t,i){"use strict";cc._RF.push(t,"5c9dbOVJ1VMHokD8LqEW2xy","constant");t.exports={WXCloudEnv:"test-foodstreet-v01",UserInfoStorgeKey:"foodstreet_record",EnemyState:{Idle:"IDLE_STATE",Walk:"WALK_STATE"},BodyShape:{Small:0,Middle:1,Large:2},HealthState:{Level1:0,Level2:1,Level3:2},Direction:{Right:1,Left:2},Event:{EnemyMove:10001,TechInfoChange:10002,StageChange:10003,CombineFinish:10004,NewBuilding:1005},BuffType:{Weight:1,Speed:2,Attack:3,AttackInterval:4},BulletType:{Normal:1,Range:2},StageState:{Prepare:1,Fight:2},NumUnit:["","K","M","B","T","aa","bb","cc","dd","ee"],SecretBoxState:{Inactive:0,Active:1,PopUp:2}},cc._RF.pop()},{}],enemyController:[function(e,t,i){"use strict";cc._RF.push(t,"9ce6aZhdRpMHqO2aDS/qkqd","enemyController");var n=e("../util/musicPlayer"),o=e("helper"),r=e("constant"),s=e("settingMgr"),a=e("enemyStateBarController"),c=e("objectFactory"),l=r.Direction,u=r.BodyShape,h=r.BuffType,d=r.BulletType;cc.Class({extends:cc.Component,properties:{stateBar:a,body:cc.Node},onLoad:function(){this.defaultBodyScaleX=this.body.scaleY,this.defaultBodyScaleY=this.body.scaleX,this.boxColliderOffset=this.node.getComponent(cc.BoxCollider).offset},update:function(e){for(var t=0;t<this.buffList.length;t++){var i=this.buffList[t];i.time-=e,i.time<=0&&(this.removeBuff(i.id,i.effectNode),this.buffList.splice(t,1),t--)}},hurt:function(e){if(this.stateBar.progressChange(e)&&!this.feedFull){this.feedFull=!0;var t=cc.loader.getRes("effectPrefab/bubble",cc.Prefab);cc.assert(t);var i=c.getObject(t);i.parent=this.node,i.getComponent("onAnimationFinish").play()}var n=this.stateBar.getBodyShape();n!==this.bodyShape&&(this.bodyShape=n,this.animation.play(this.clips[this.bodyShape].name).wrapMode=cc.WrapMode.Loop)},stopMove:function(){this.node.pauseAllActions()},startMove:function(){this.move(this.movePath[this.step])},resumeMove:function(){this.node.resumeAllActions()},leave:function(){var e=this.movePath[this.movePath.length-1].position,t=this.movePath[this.movePath.length-2].position,i=e.add(e.sub(t)),n=o.calDistance(this.node.position,i)/Math.floor(this.attribute.speed*(1+this.buffSpeed));this.node.runAction(cc.spawn(cc.fadeOut(1),cc.moveTo(n,i)))},getHitPoint:function(){return this.node.position.add(cc.v2(0,this.boxHeight))},init:function(e,t,i,n,o){this.node.stopAllActions();var r=s.getSetting("enemy").getEnemyInfo(t);cc.assert(r),this.id=e,this.boxHeight=this.node.getComponent(cc.BoxCollider).offset.y,this.towerController=o,this.feedFull=!1,this.reach=!1,this.attribute={},this.attribute.hp=parseFloat(r.hp*n),this.attribute.speed=r.speed,this.buffSpeed=0,this.buffSpeedDuration=0,this.buffEffectNode=null,this.buffList=[],this.stateBar.init(this.attribute.hp),this.bodyShape=u.Small,this.movePath=i,this.moveAction=null,this.direction=i[0].direction,this.step=0,this.node.opacity=255,this.animation=this.body.getComponent(cc.Animation),this.animation.stop(),this.clips=this.animation.getClips(),this.animation.play(this.clips[this.bodyShape].name).wrapMode=cc.WrapMode.Loop,this.direction===l.Left?this.body.scaleX=-Math.abs(this.body.scaleX):this.body.scaleX=Math.abs(this.body.scaleX)},move:function(e){var t=o.calDistance(this.node.position,e.position);this.moveAction&&!this.moveAction.isDone()&&this.node.stopAction(this.moveAction),this.moveAction=cc.sequence(cc.moveTo(t/Math.floor(this.attribute.speed*(1+this.buffSpeed)),e.position),cc.callFunc(function(){e.direction===l.Left?this.body.scaleX=-Math.abs(this.body.scaleX):this.body.scaleX=Math.abs(this.body.scaleX),this.direction=e.direction,this.node.zIndex=-Math.floor(this.node.position.y),this.nextStep()},this)),this.node.runAction(this.moveAction)},nextStep:function(){this.step++,this.step<this.movePath.length?this.move(this.movePath[this.step]):(this.reach=!0,this.towerController.onEnemyReach(this))},isFeedFull:function(){return this.feedFull},addBuff:function(e,t){var i=Math.random(),n=s.getSetting("buff").getBuffInfo(e);if(i<=t){var o=!0;if(n.duration>0){for(var r=0;r<this.buffList.length;r++){var a=this.buffList[r];if(a.id===e){a.time=n.duration,o=!1;break}}if(o){var l={};l.id=e,l.time=n.duration;var u=cc.loader.getRes("buffPrefab/"+n.prefab,cc.Prefab),d=c.getObject(u);d.parent=this.node,l.effectNode=d,this.buffList.push(l)}}o&&(n.type===h.Weight?hurt+=n.value:n.type===h.Speed?(this.buffSpeed+=n.value,this.move(this.movePath[this.step])):n.type===h.Attack||(n.type,h.AttackInterval))}},removeBuff:function(e,t){var i=s.getSetting("buff").getBuffInfo(e);i.type===h.Weight||(i.type===h.Speed?(this.buffSpeed-=i.value,this.move(this.movePath[this.step])):i.type===h.Attack||(i.type,h.AttackInterval)),t&&c.putObject(t)},onCollisionEnter:function(e,t){if("bullet"===e.node.group){var i=e.node.getComponent("bulletController");if(i.target!==this.node)return;if(!i.hit){this.towerController.onBulletHit(i),i.hit=!0,this.body.stopAllActions(),this.direction===l.Left?this.body.scaleX=-Math.abs(this.defaultBodyScaleX):this.body.scaleX=Math.abs(this.defaultBodyScaleX);var o=this.body.scaleX,r=cc.sequence(cc.scaleTo(.1,1.1*o,1.1),cc.scaleTo(.1,o,1));this.body.runAction(r),n.MusicPlayer.playEffectHit();var s=i.hurt;i.buff&&d.Normal===i.bulletType&&this.addBuff(i.buff,i.buffPosibility),this.hurt(s),c.putObject(e.node);var a=cc.loader.getRes("effectPrefab/effect_hit",cc.Prefab);cc.assert(a);var u=c.getObject(a);u.parent=this.towerController.bulletLayer,u.position=this.node.position.addSelf(this.boxColliderOffset),u.getComponent("onAnimationFinish").play()}if(i.bulletType===d.Range){var h=cc.loader.getRes(""+i.bulletAttr.explodePrefab,cc.Prefab);cc.assert(h);var g=c.getObject(h);g.parent=this.towerController.bulletLayer,g.position=this.node.position,g.getComponent("explodeController").init(i.bulletAttr,i.hurt)}}else if("explode"===e.node.group){var f=e.node.getComponent("explodeController"),p=f.bulletAttr,v=f.hurt;p.buff&&this.addBuff(p.buff,p.buffPosibility),this.hurt(v);var m=cc.loader.getRes("effectPrefab/effect_hit",cc.Prefab);cc.assert(m);var b=c.getObject(m);b.parent=this.towerController.bulletLayer,b.position=this.node.position.addSelf(this.boxColliderOffset),b.getComponent("onAnimationFinish").play()}}}),cc._RF.pop()},{"../util/musicPlayer":"musicPlayer",constant:"constant",enemyStateBarController:"enemyStateBarController",helper:"helper",objectFactory:"objectFactory",settingMgr:"settingMgr"}],enemyGroupSetting:[function(e,t,i){"use strict";cc._RF.push(t,"404a3TlsypD1KoAVjt3aML0","enemyGroupSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this.groupMap={}}return n(e,[{key:"parse",value:function(e){this.groupMap=e}},{key:"getEnemyGroupArray",value:function(e){return this.groupMap[e].enemyArray}}]),e}();t.exports=r,cc._RF.pop()},{}],enemySetting:[function(e,t,i){"use strict";cc._RF.push(t,"3219f8fFVhKj5liZcd1J+ks","enemySetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};e.id&&(i.id=e.id,i.hp=e.HP,i.speed=e.speed,i.prefab=e.prefab,t._infoMap[i.id]=i)})}},{key:"getEnemyInfo",value:function(e){return this._infoMap[e]}}]),e}();t.exports=r,cc._RF.pop()},{}],enemyStateBarController:[function(e,t,i){"use strict";cc._RF.push(t,"e2ff9RVzPRGypsf1Fy0iM1v","enemyStateBarController");var n=e("constant"),o=n.BodyShape,r=n.HealthState;cc.Class({extends:cc.Component,properties:{progressBar:cc.ProgressBar,barSprite:cc.Sprite,healthStateSpriteFrame:[cc.SpriteFrame]},onLoad:function(){},init:function(e){this.currentValue=0,this.maxValue=e,this.bodyShape=o.Small,this.healthState=r.Level1,this.currentProgress=0,this.progressBar.progress=0,this.node.opacity=255,this.refreshBar()},progressChange:function(e){this.currentValue+=parseInt(e),this.bodyShape=this.calBodyShape(this.currentValue),this.healthState=this.calHealthState(this.currentValue);var t=this.formatFloat(this.currentValue/this.maxValue);return this.currentProgress=t,this.refreshBar(),this.currentValue>=this.maxValue&&(this.currentValue=this.maxValue,this.node.runAction(cc.fadeOut(1)),!0)},refreshBar:function(){var e=this.getHealthStateSprite(this.healthState);e&&(this.barSprite.spriteFrame=e),this.progressBar.progress=this.formatFloat(this.currentProgress)},calBodyShape:function(e){var t=this.maxValue/2;return e<t?o.Small:e>=t&&e<this.maxValue?o.Middle:e>=this.maxValue?o.Large:void 0},calHealthState:function(e){var t=this.maxValue/3,i=this.maxValue/3*2;return e<t?r.Level1:e>=t&&e<i?r.Level2:e>=i?r.Level3:void 0},getBodyShape:function(){return this.bodyShape},getHealthStateSprite:function(e){switch(e){case r.Level1:return this.healthStateSpriteFrame[0];case r.Level2:return this.healthStateSpriteFrame[1];case r.Level3:return this.healthStateSpriteFrame[2]}},formatFloat:function(e){return e>1?1:parseFloat(e.toFixed(2))}}),cc._RF.pop()},{constant:"constant"}],explodeController:[function(e,t,i){"use strict";cc._RF.push(t,"c1a72oA04RC5KROke25BZmS","explodeController");var n=e("objectFactory");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.anim=this.node.getComponent(cc.Animation),this.anim.on("finished",this.onAnimationFinished,this)},init:function(e,t){this.bulletAttr=e,this.hurt=t,this.anim.play()},onAnimationFinished:function(){n.putObject(this.node)}}),cc._RF.pop()},{objectFactory:"objectFactory"}],gameManager:[function(e,t,i){"use strict";cc._RF.push(t,"040f7Kr/b9A25arUC8Floej","gameManager");var n=e("settingMgr"),o=(e("constant"),e("objectFactory")),r=cc.Class({extends:cc.Component,properties:{enabledDebugDraw:cc.Boolean=!1,progressBar:cc.ProgressBar,text:cc.Label},statics:{instance:null,getInstance:function(){return r.instance}},initPhysis:function(){var e=this;return new Promise(function(t,i){var n=cc.director.getCollisionManager();n.enabled=!0,n.enabledDebugDraw=e.enabledDebugDraw,t()})},initWXEnv:function(){return new Promise(function(e,t){e()})},onLoad:function(){var e=this;cc.debug.setDisplayStats(!1),cc.game.addPersistRootNode(this.node),null==r.instance?r.instance=this:r.instance!=this&&this.node.destroy(),this._counter=0,n.init().then(function(){e.progressBar.progress=.1,e.text.string="\u6b63\u5728\u751f\u706b\u2026",e.initPhysis().then(function(){e.progressBar.progress=.2,e.text.string="\u6b63\u5728\u64e6\u684c\u5b50\u2026\u2026",e.initWXEnv().then(function(){e.progressBar.progress=.3,e.text.string="\u6b63\u5728\u51c6\u5907\u98df\u6750\u2026",e.loadRes().then(function(){e.progressBar.progress=1,e.text.string="\u5f00\u59cb\u8425\u4e1a\uff01",cc.director.loadScene("MainScene")})})})})},checker:function(){return this._counter--,this.progressBar.progress+=(1-this.progressBar.progress)/5,this._counter%2==0?this.text.string="\u6b63\u5728\u51c6\u5907\u98df\u6750\u2026":this.text.string="\u6b63\u5728\u51c6\u5907\u98df\u6750\u2026\u2026",this._counter<=0},loadRes:function(){var e=this;return new Promise(function(t,i){e._counter++,cc.loader.loadResDir("buffPrefab",cc.Prefab,function(n,r){n?(cc.assert(n),i()):(r.forEach(function(e){e instanceof cc.Prefab?(console.info("loading buffPrefab:"+e.name),o.buildObjectPool(e,5)):cc.assert("not buffPrefab element: "+e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("buildingPrefab",cc.Prefab,function(n,r){n?(cc.assert(n),i()):(r.forEach(function(e){e instanceof cc.Prefab?(console.info("loading buildingPrefab:"+e.name),o.buildObjectPool(e,2)):cc.assert(!1,"not buildingPrefab element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("bulletPrefab",cc.Prefab,function(i,n){i?cc.assert(i):(n.forEach(function(e){e instanceof cc.Prefab?(console.info("loading bulletPrefab: "+e.name),o.buildObjectPool(e,5)):cc.assert(!1,"not bulletPrefab element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("effectPrefab",cc.Prefab,function(n,r){n?(cc.assert(n),i()):(r.forEach(function(e){e instanceof cc.Prefab?(console.info("loading effectPrefab: "+e.name),o.buildObjectPool(e,5)):cc.assert(!1,"not effectPrefab element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("rolePrefab",cc.Prefab,function(n,r){n?(cc.assert(n),i()):(r.forEach(function(e){e instanceof cc.Prefab?(o.buildObjectPool(e,20),console.info("loading rolePrefab:"+e.name)):cc.assert(!1,"not rolePrefab element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("map",cc.TiledMapAsset,function(n,o){n?(cc.assert(n),i()):(o.forEach(function(e){e instanceof cc.TiledMapAsset?console.info("loading TiledMapAsset:"+e.name):cc.assert(!1,"not TiledMapAsset element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("map",cc.SpriteAtlas,function(i,n){i?cc.assert(i):(n.forEach(function(e){e instanceof cc.SpriteAtlas?console.info("loading SpriteAtlas:"+e.name):cc.assert(!1,"not SpriteAtlas element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("sprite/technology",cc.SpriteFrame,function(n,o){n?(cc.assert(n),i()):(o.forEach(function(e){e instanceof cc.SpriteFrame?console.info("loading sprite/technology:"+e.name):cc.assert(!1,"not Sprite element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("sprite/building",cc.SpriteFrame,function(n,o){n?(cc.assert(n),i()):(o.forEach(function(e){e instanceof cc.SpriteFrame?console.info("loading sprite/building:"+e.name):cc.assert(!1,"not Sprite element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("sprite/preload",cc.SpriteFrame,function(n,o){n?(cc.assert(n),i()):(o.forEach(function(e){e instanceof cc.SpriteFrame?console.info("loading sprite/preload:"+e.name):cc.assert(!1,"not Sprite element "+ +e.name)}),e.checker()&&t())}),e._counter++,cc.loader.loadResDir("sound",cc.AudioClip,function(n,o){n?(cc.assert(n),i()):(o.forEach(function(e){e instanceof cc.AudioClip?console.info("loading sound:"+e.name):cc.assert(!1,"not sound element "+ +e.name)}),e.checker()&&t())})})}});cc._RF.pop()},{constant:"constant",objectFactory:"objectFactory",settingMgr:"settingMgr"}],gameScene:[function(e,t,i){"use strict";cc._RF.push(t,"18e79YZngREPqoYGlWkcSPC","gameScene");var n=e("operationController"),o=e("userController");cc.Class({extends:cc.Component,properties:{operationController:n,userController:o},onLoad:function(){this.userController.init(),this.operationController.init(this.userController.getUserInfo())}}),cc._RF.pop()},{operationController:"operationController",userController:"userController"}],guideController:[function(e,t,i){"use strict";cc._RF.push(t,"4dd371u3PhMz7MM30TNga73","guideController");var n=function(e){return e&&e.__esModule?e:{default:e}}(e("../util/UserInfo"));cc.Class({extends:cc.Component,properties:{fingerPrefab:cc.Prefab,textPrefab:cc.Prefab,task:cc.String,guideState:cc.String,welcomePrefab:cc.Prefab,buyPrefab:cc.Prefab},onLoad:function(){this.node.active=!0,cc.log("UserInfo.getInstance().getCoin()"+n.default.getInstance().getCoin()),n.default.getInstance().setCoin(5),cc.log("UserInfo.getInstance().getCoin()"+n.default.getInstance().getCoin()),this.welcomeGuide()},start:function(){},close:function(){this.node.active=!1},welcomeGuide:function(){cc.instantiate(this.welcomePrefab)},buyGuide:function(){this.showText("\u8bf7\u70b9\u51fb\u8d2d\u4e70\u5efa\u7b51")},buyAgainGuide:function(){this.showText("\u8bf7\u518d\u6b21\u70b9\u51fb\u53ef\u4ee5\u7ee7\u7eed\u8d2d\u4e70\u5efa\u7b51")},combineGuide:function(){this.showText("\u8bf7\u62d6\u52a8\u5efa\u7b51\u5230\u5176\u4ed6\u5efa\u7b51\u4e0a\uff0c\u6765\u5408\u6210\u9ad8\u7ea7\u5efa\u7b51")},moveToTowerGuide:function(){this.showText("\u8bf7\u62d6\u52a8\u5efa\u7b51\u5230\u9053\u8def\u4e0a\uff0c\u6765\u5582\u9971\u524d\u6765\u7684\u987e\u5ba2\u54e6\uff01")},startGuide:function(){this.showText("\u8bf7\u70b9\u51fb\u5f00\u59cb\u6765\u5582\u9971\u524d\u6765\u7684\u987e\u5ba2")},focusFromNodeToTargetNode:function(e,t){this._mask._graphics.clear();var i=e.getBoundingBoxToWorld(),n=t.getBoundingBoxToWorld(),o=this.node.convertToNodeSpaceAR(i.origin);this.node.convertToNodeSpaceAR(n.origin);return this._mask._graphics.fillRect(o.x,o.y,i.width+n.width,i.height),new cc.Rect(o.x,o.y,i.width+n.width,i.height)},focusFormNodeToTowerNode:function(e,t){this._mask._graphics.clear();var i=e.getBoundingBoxToWorld(),n=t.getBoundingBoxToWorld(),o=this.node.convertToNodeSpaceAR(i.origin),r=this.node.convertToNodeSpaceAR(n.origin).y-o.y;return this._mask._graphics.fillRect(o.x,o.y,i.width,r+n.height/2),new cc.Rect(o.x,o.y,i.width,r+n.height/2)},showText:function(e){var t=this.text.getComponentInChildren(cc.Label);this.text.active=!0,t.text=e}}),cc._RF.pop()},{"../util/UserInfo":"UserInfo"}],helper:[function(e,t,i){"use strict";cc._RF.push(t,"1d522YKHrpBa6nR4oiW0yBR","helper");var n=e("constant"),o=(n.Direction,{wxShare:function(e,t,i,n){wx.shareAppMessage({title:e,imageUrl:t,query:n,imageUrlId:i})},wxShowVideoWithPromise:function(){return new Promise(function(e,t){var i=wx.createRewardedVideoAd({adUnitId:"adunit-cb415f5547761860"});wx.showLoading({title:"\u52a0\u8f7d\u4e2d",mask:!0});var n=!1,o=setTimeout(function(){console.log("timeout"),wx.hideLoading({}),e({isEnded:!1,err:"\u62c9\u53d6\u5e7f\u544a\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}),n=!0},1e4);i.load().then(function(){n||(wx.hideLoading({}),clearTimeout(o),i.show())}).catch(function(t){n||(wx.hideLoading({}),clearTimeout(o),"no advertisement"===t.errMsg?e({isEnded:!1,err:"\u4eca\u65e5\u5e7f\u544a\u64ad\u653e\u6b21\u6570\u5df2\u8fbe\u4e0a\u9650"}):e({isEnded:!1,err:"\u62c9\u53d6\u5e7f\u544a\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}))}),i.offError(),i.onError(function(e){return console.log(err)}),i.offClose(),i.onClose(function(t){clearTimeout(o),e({isEnded:t&&t.isEnded||void 0===t})})})},isToday:function(e){var t=new Date,i=new Date(1e3*e);return t.setHours(0,0,0,0)===i.setHours(0,0,0,0)},isSameDay:function(e,t){var i=new Date(e),n=new Date(t);return i.setHours(0,0,0,0)===n.setHours(0,0,0,0)},nowUnixSec:function(){return Math.round((new Date).getTime()/1e3)},random:function(e,t){return Math.floor(Math.random()*(t-e))+e},genID:function(){var e=Date.now().toString(36);return e+=Math.random().toString(36).substr(3)},getPointOnCycle:function(e,t,i){return i=i||cc.Vec2.ZERO,cc.Vec2.RIGHT.rotate(e).mulSelf(t).addSelf(i)},getVectorRad:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},calRad:function(e,t){var i=t.x-e.x,n=t.y-e.y,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));return n>=0?Math.acos(i/o):2*Math.PI-Math.acos(i/o)},calDistance:function(e,t){return t.sub(e).mag()},numToStringWithUnit:function(e){if(0===e)return 0;var t=Math.floor(Math.log10(e)/3);return t>=n.NumUnit.length&&(t=n.NumUnit.length-1),(Math.floor(e/Math.pow(10,3*t)*10)/10).toString()+n.NumUnit[t]},sprResizeByScale:function(e,t){var i=e.spriteFrame.getOriginalSize(),n=t/Math.max(i.width,i.height);e.node.width=n*i.width,e.node.height=n*i.height}});t.exports=o,cc._RF.pop()},{constant:"constant"}],losePanelController:[function(e,t,i){"use strict";cc._RF.push(t,"56fedSxXFxIsZc3o7kJn2xR","losePanelController");var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,a=r.property,c=(e("../util/Helper"),e("../setting/settingMgr")),l=e("./towerController"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.towerController=null,t.progressBar=null,t.lightNode=null,t.quitNode=null,t.roleAnim=null,t._totalTime=0,t._restTime=0,t._tickInterval=.1,t._quitBtnShowTime=0,t._enemy=null,t}return n(t,e),t.prototype.init=function(e){var t=c.getSetting("constant");this._totalTime=t.getValue("REVIVE_BTN_TIME"),this._quitBtnShowTime=this._totalTime-t.getValue("NO_REVIVE_BTN_SHOW_TIME"),this._restTime=this._totalTime,this.roleAnim.addClip(e.animation.currentClip),this.roleAnim.play(e.animation.currentClip.name),this.lightNode.scale=3,this.lightNode.position=this.lightNode.parent.convertToNodeSpaceAR(e.node.convertToWorldSpaceAR(cc.v2(0,e.boxHeight))),this.lightNode.runAction(cc.scaleTo(.5,1)),this._enemy=e,this.schedule(this.ticker,this._tickInterval)},t.prototype.ticker=function(){this._restTime-=this._tickInterval,this._restTime>0?(this.progressBar.progress=(this._totalTime-this._restTime)/this._totalTime,!1===this.quitNode.active&&this._restTime<this._quitBtnShowTime&&(this.quitNode.active=!0)):this.quit()},t.prototype.clickRebornBtn=function(){var e=this._enemy;e.leave(),e.hurt(e.attribute.hp),this.towerController.resumeDefend(),this.node.active=!1},t.prototype.quit=function(){this.towerController.backToMain(),this.node.active=!1},o([a(l)],t.prototype,"towerController",void 0),o([a(cc.ProgressBar)],t.prototype,"progressBar",void 0),o([a(cc.Node)],t.prototype,"lightNode",void 0),o([a(cc.Node)],t.prototype,"quitNode",void 0),o([a(cc.Animation)],t.prototype,"roleAnim",void 0),t=o([s],t)}(cc.Component);i.default=u,cc._RF.pop()},{"../setting/settingMgr":"settingMgr","../util/Helper":"helper","./towerController":"towerController"}],mapSetting:[function(e,t,i){"use strict";cc._RF.push(t,"2109bg0UVJLtqo6+yridcac","mapSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._mapSet={}}return n(e,[{key:"parse",value:function(e){var t={};if(e.stage){t.name=e.name,t.stage=e.stage,t.width=e.width,t.height=e.height,t.tileWidth=e.tileWidth,t.tileHeight=e.tileHeight,t.roadMap=e.roadMap,t.obstacleMap=e.obstacleMap;var i=e.entrances;cc.assert(Array.isArray(i)),t.entrancesMap={},t.entranceIndexArray=[],i.forEach(function(e){var i=e.x+e.y*t.width;t.entranceIndexArray.push(i),t.entrancesMap[e.id]=cc.v2(e.x,e.y)}),t.exit=cc.v2(e.exit_point.x,e.exit_point.y),this._mapSet[t.name]=t}}},{key:"getStage",value:function(e){return this._mapSet[e].stage}},{key:"getRoadMap",value:function(e){return this._mapSet[e].roadMap}},{key:"getObstacleMap",value:function(e){return this._mapSet[e].obstacleMap}},{key:"getMapSize",value:function(e){return cc.size(this._mapSet[e].width,this._mapSet[e].height)}},{key:"getTileSize",value:function(e){return cc.size(this._mapSet[e].tileWidth,this._mapSet[e].tileHeight)}},{key:"getWidth",value:function(e){return this._mapSet[e].width}},{key:"getHeight",value:function(e){return this._mapSet[e].height}},{key:"getTileWidth",value:function(e){return this._mapSet[e].tileWidth}},{key:"getTileHeight",value:function(e){return this._mapSet[e].tileHeight}},{key:"getEntrance",value:function(e,t){var i=this._mapSet[e].entrancesMap[t];return cc.v2(i.x,i.y)}},{key:"isEntranceByIndex",value:function(e,t){for(var i=this._mapSet[e].entranceIndexArray,n=0;n<i.length;n++)if(t===i[n])return!0;return!1}},{key:"getExit",value:function(e){return this._mapSet[e].exit}}]),e}();t.exports=r,cc._RF.pop()},{}],modalUI:[function(e,t,i){"use strict";cc._RF.push(t,"bd973c8qEVDKJ1qRYXV3GHv","modalUI"),cc.Class({extends:cc.Component,properties:{mask:cc.Node},onLoad:function(){},onEnable:function(){this.mask.on(cc.Node.EventType.TOUCH_START,function(e){e.stopPropagation()}),this.mask.on(cc.Node.EventType.TOUCH_MOVE,function(e){e.stopPropagation()}),this.mask.on(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation()}),this.mask.on(cc.Node.EventType.TOUCH_CANCEL,function(e){e.stopPropagation()})},onDisable:function(){this.mask.off(cc.Node.EventType.TOUCH_START,function(e){e.stopPropagation()}),this.mask.off(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation()}),this.mask.off(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation()}),this.mask.off(cc.Node.EventType.TOUCH_CANCEL,function(e){e.stopPropagation()})}}),cc._RF.pop()},{}],musicPlayer:[function(e,t,i){"use strict";cc._RF.push(t,"ce9a7qAJZxAoKBDiG6DfQ3W","musicPlayer"),Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(){}return e.playPrepareBGM=function(){var e=cc.loader.getRes("sound/music_prepare",cc.AudioClip);cc.audioEngine.playMusic(e,!0)},e.playFightBGM=function(){var e=cc.loader.getRes("sound/music_fight",cc.AudioClip);cc.audioEngine.playMusic(e,!0)},e.resumeMusic=function(){cc.audioEngine.resumeMusic()},e.stopBGM=function(){cc.audioEngine.stopMusic()},e.pauseBGM=function(){cc.audioEngine.pauseMusic()},e.stopAllEffect=function(){cc.audioEngine.stopAllEffects()},e.playEffectLose=function(){var e=cc.loader.getRes("sound/sound_lose",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectWin=function(){var e=cc.loader.getRes("sound/sound_win",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectCombine=function(){var e=cc.loader.getRes("sound/sound_compound",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectBuy=function(){var e=cc.loader.getRes("sound/sound_buy",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectSale=function(){var e=cc.loader.getRes("sound/sound_sale",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectLvlUp=function(){var e=cc.loader.getRes("sound/sound_lvlup",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectPlace=function(){var e=cc.loader.getRes("sound/sound_place",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectWrong=function(){var e=cc.loader.getRes("sound/sound_wrong",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectHit=function(){var e=cc.loader.getRes("sound/sound_smash",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.playEffectStart=function(){var e=cc.loader.getRes("sound/sound_start",cc.AudioClip);cc.audioEngine.playEffect(e,!1)},e.vibrateShort=function(){0},e.vibrateLong=function(){0},e}();i.MusicPlayer=n,cc._RF.pop()},{}],objectFactory:[function(e,t,i){"use strict";cc._RF.push(t,"aa6fdmlkZhPAJWO9JS9/4dw","objectFactory");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=new(function(){function e(){o(this,e),this._pools={}}return n(e,[{key:"buildObjectPool",value:function(e,t){for(var i=new cc.NodePool,n=0;n<t;n++){var o=cc.instantiate(e);i.put(o)}this._pools[e.name]=i}},{key:"destroyAllPool",value:function(){var e=this;Object.keys(this._pools).forEach(function(t){e._pools[t].clear()})}},{key:"getObject",value:function(e){var t=this._pools[e.name];if(!t)return null;var i=t.get();return i||(i=cc.instantiate(e),console.info("pool object not enough instantiate new object: "+e.name+" pool size:"+t.size())),i}},{key:"putObject",value:function(e){var t=this._pools[e.name];if(!t)return console.error("putObject object pool not exist. object: "+e.name),void e.destroy();t.put(e)}}]),e}());t.exports=r,cc._RF.pop()},{}],offlinePanelController:[function(e,t,i){"use strict";cc._RF.push(t,"99be5RJehJBQ62f8KpCaGIF","offlinePanelController");var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,a=r.property,c=e("../setting/settingMgr"),l=e("../util/helper"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.profitLabel=null,t.offlineDurationLabel=null,t.upperLabelNode=null,t}return n(t,e),t.prototype.init=function(e,t){var i=c.getSetting("constant").getValue("OFFLINE_REWARD_TIME_MAX");this.profitLabel.string=l.numToStringWithUnit(e);var n=Math.ceil(t/60);this.offlineDurationLabel.string="<b>\u4f60\u83b7\u5f97"+n+"\u5206\u949f\u79bb\u7ebf\u5956\u52b1</b>",this.upperLabelNode.active=t>=i},o([a(cc.Label)],t.prototype,"profitLabel",void 0),o([a(cc.RichText)],t.prototype,"offlineDurationLabel",void 0),o([a(cc.Node)],t.prototype,"upperLabelNode",void 0),t=o([s],t)}(cc.Component);i.default=u,cc._RF.pop()},{"../setting/settingMgr":"settingMgr","../util/helper":"helper"}],onAnimationFinish:[function(e,t,i){"use strict";cc._RF.push(t,"f952cPsLRFJWZ8oIasde+JC","onAnimationFinish");var n=e("objectFactory");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.anim=this.node.getComponent(cc.Animation),this.anim.on("finished",this.onAnimationFinished,this)},play:function(){this.anim.play()},onAnimationFinished:function(){n.putObject(this.node)}}),cc._RF.pop()},{objectFactory:"objectFactory"}],operationController:[function(e,t,i){"use strict";cc._RF.push(t,"e0e9eA7Ax9B9J6ST+R8H5Av","operationController");var n=r(e("../util/UserInfo")),o=r(e("./buildingTipController"));function r(e){return e&&e.__esModule?e:{default:e}}var s=e("uiController"),a=(e("objectFactory"),e("helper")),c=0,l=1,u=2;cc.Class({extends:cc.Component,properties:{combineNode:cc.Node,towerNode:cc.Node,uiController:s,buildingTipController:o.default,dragBuildingLayer:cc.Node,dragItemPrefab:cc.Prefab,dragItemLayer:cc.Node},onLoad:function(){this.isCheckValidArea=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},init:function(e){this.combineController=this.combineNode.getComponent("combineController"),this.towerController=this.towerNode.getComponent("towerController"),e=n.default.getSingleton(),cc.log("operationController"+JSON.stringify(e)),this.combineController.init(e),this.towerController.init(e.getStage(),e.getTowerBuildingRecord()),this.dragslotController=null,this.dragBuildingController=null,this.dragBuildingNode=null,this.dragItemNode=null,this.lastTileIndex=-1},createDragItem:function(e,t){this.dragItemNode&&(this.dragItemNode.destroy(),this.dragItemNode=null),this.dragItemNode=cc.instantiate(this.dragItemPrefab),this.dragItemNode.parent=this.dragItemLayer,this.dragItemNode.position=this.dragItemLayer.convertToNodeSpaceAR(e);var i=this.dragItemNode.getComponent(cc.Sprite);i.spriteFrame=t,a.sprResizeByScale(i,100)},moveDragItem:function(e){this.dragItemNode.position=this.dragItemLayer.convertToNodeSpaceAR(e)},showDragItem:function(){this.dragItemNode&&(this.dragItemNode.active=!0)},hideDragItem:function(){this.dragItemNode&&(this.dragItemNode.active=!1)},isDragItemExist:function(){return!!this.dragItemNode},destoryDragItem:function(){this.dragItemNode&&(this.dragItemNode.destroy(),this.dragItemNode=null)},releaseDrag:function(){this.destoryDragItem(),this.destroyDragBuilding(),this.combineController.stopShine(),this.combineController.clearRecyclePriceShow(),this.buildingTipController.setInactive()},createDragBuilding:function(e,t,i){this.dragBuildingNode&&(this.dragBuildingNode.destroy(),this.dragBuildingNode=null);var n=cc.loader.getRes("buildingPrefab/"+t,cc.Prefab);this.dragBuildingNode=cc.instantiate(n),this.dragBuildingNode.parent=this.dragBuildingLayer,this.dragBuildingNode.position=e;var o=this.dragBuildingNode.getComponent("buildingController");o.showGreenBase(),o.showAttackRange(i),o.changeAttackRangeGreen(),this.dragBuildingNode.zIndex=cc.macro.MAX_ZINDEX},moveDragBuilding:function(e){var t=this.towerController.touchPosToTileGridIndex(e);if(t!==this.lastTileIndex){var i=this.towerController.gridIndexToTileMapGridCoord(t),n=this.towerController.tileMapGridCoordToMapNodePos(i),o=this.towerController.mapNodePosToWorldSpaceAR(n);this.dragBuildingNode.position=this.dragBuildingLayer.convertToNodeSpaceAR(o),this.lastTileIndex=t;var r=this.dragBuildingNode.getComponent("buildingController");this.towerController.isRoad(t)?(r.showRedBase(),r.changeAttackRangeRed()):(r.showGreenBase(),r.changeAttackRangeGreen())}},hideDragBuilding:function(){this.dragBuildingNode&&(this.dragBuildingNode.active=!1)},showDragBuilding:function(){this.dragBuildingNode&&(this.dragBuildingNode.active=!0)},isDragBuildingExist:function(){return!!this.dragBuildingNode},destroyDragBuilding:function(){this.dragBuildingNode&&(this.dragBuildingNode.destroy(),this.dragBuildingNode=null)},onTouchStart:function(e){if(!this.touchId||this.touchId==e.getID()){this.touchId=e.getID();var t=e.getLocation();if(this.opMode=c,this.towerController.isTowerArea(t)){this.towerController.onTouchStart(t);var i=this.towerController.isTouchBuilding(t);if(!(i&&i.buildingController&&i.index))return void(this.touchId=null);this.opMode=u,this.dragBuildingIndex=i.index,this.dragBuildingController=i.buildingController;var n=this.dragBuildingController.getBuildingPrefabName(),o=this.dragBuildingController.getAttackRange();this.createDragBuilding(i.buildingController.node.position,n,o),this.dragBuildingController.hide(),this.towerController.setDragingState(!0),this.combineController.shineIfSameID(this.dragBuildingController.getBuildingID()),this.buildingTipController.setInfo(this.dragBuildingController.getBuildingID()),this.buildingTipController.setActive()}else{if(!this.combineController.isBuildingTab())return void(this.touchId=null);var r=this.combineController.getTouchSlotGrid(t);if(!r||r.isEmpty())return void(this.touchId=null);this.opMode=l,this.slotController=r;var s=r.getSpriteFrame();this.createDragItem(t,s),this.slotController.hide(),this.combineController.shineIfSameID(this.slotController.getSlotBuildingID()),this.combineController.setRecyclePriceShow(this.slotController.getSlotBuildingLevel()),this.buildingTipController.setInfo(this.slotController.getSlotBuildingID()),this.buildingTipController.setActive()}}},setValidArea:function(e){this.setIsCheckValidArea(!0),this.validArea=e},setIsCheckValidArea:function(e){this.isCheckValidArea=e},isGuideArea:function(e,t){var i=e.convertToNodeSpaceAR(t);return e.getBoundingBox().contains(i)},onTouchMove:function(e){if(e.getID()==this.touchId){var t=e.getLocation();if(this.opMode===l){if(this.isCheckValidArea&&!this.validArea.contains(t))return void(this.touchId=null);if(this.towerController.isTowerArea(t)){if(this.hideDragItem(),!this.isDragBuildingExist()){var i=this.slotController.getSlotInfo(),n=this.dragBuildingLayer.convertToNodeSpaceAR(t);this.createDragBuilding(n,i.buildingPrefabName,i.buildingAttackRange)}this.showDragBuilding(),this.moveDragBuilding(t)}else this.combineController.isTouchRecycleButtton(t)?this.combineController.recycleNode.scale=1.2:this.combineController.recycleNode.scale=1,this.hideDragBuilding(),this.showDragItem(),this.moveDragItem(t)}else if(this.opMode===u)if(this.towerController.isTowerArea(t))this.hideDragItem(),this.showDragBuilding(),this.moveDragBuilding(t);else{if(!this.combineController.isBuildingTab())return void(this.touchId=null);if(!this.isDragItemExist()){var o=this.dragBuildingController.getSpriteFrame();this.createDragItem(t,o)}this.hideDragBuilding(),this.showDragItem(),this.moveDragItem(t)}else this.towerController.onTouchMove(t)}},onTouchEnd:function(e){this.towerController.onTouchEnd();var t=e.getLocation();if(this.opMode===l)if(this.towerController.isTowerArea(t)){var i=this.slotController.getSlotInfo().buildingID;this.towerController.placeBuilding(i,this.dragBuildingNode,t)?this.slotController.reset():this.slotController.show(),this.slotController=null,this.releaseDrag()}else{if(this.combineController.isTouchRecycleButtton(t))return this.combineController.recycleBuilding(this.slotController.getSlotBuildingLevel()),this.combineController.recycleNode.scale=1,this.slotController.reset(),this.slotController=null,this.combineController.savePacakgeRecord(),this.releaseDrag(),void(this.touchId=null);var n=this.combineController.getTouchSlotGrid(t);if(!n)return this.slotController.show(),this.slotController=null,this.releaseDrag(),void(this.touchId=null);if(n.getIndex()===this.slotController.getIndex())return this.slotController.show(),this.slotController=null,this.releaseDrag(),void(this.touchId=null);if(n.combineSlot(this.slotController)){n.getSlotInfo().buildingID;this.slotController.reset(),this.combineController.savePacakgeRecord()}else n.replace(this.slotController)?(this.slotController.reset(),this.combineController.savePacakgeRecord()):this.slotController.show();this.slotController=null,this.releaseDrag()}else if(this.opMode===u)if(this.towerController.isTowerArea(t)){if(this.towerController.isTouchBuildingExceptIndex(t,this.dragBuildingIndex))return this.releaseDrag(),this.dragBuildingController.show(),this.dragBuildingController=null,this.towerController.setDragingState(!1),this.uiController.generateTip("10301"),void(this.touchId=null);var o=this.dragBuildingController.getBuildingID();this.towerController.placeBuilding(o,this.dragBuildingNode,t)?(this.releaseDrag(),this.towerController.removeBuilding(this.dragBuildingIndex),this.dragBuildingController=null,this.towerController.setDragingState(!1)):(this.releaseDrag(),this.dragBuildingController.show(),this.dragBuildingController=null,this.towerController.setDragingState(!1))}else{if(!this.combineController.isBuildingTab())return this.releaseDrag(),this.dragBuildingController.show(),this.dragBuildingController=null,this.towerController.setDragingState(!1),void(this.touchId=null);if(this.combineController.isTouchRecycleButtton(t))return this.combineController.recycleBuilding(this.dragBuildingController.getBuildingLevel()),this.releaseDrag(),this.towerController.removeBuilding(this.dragBuildingIndex),this.dragBuildingController=null,this.towerController.setDragingState(!1),void(this.touchId=null);var r=this.combineController.getTouchSlotGrid(t);if(!r)return this.releaseDrag(),this.dragBuildingController.show(),this.dragBuildingController=null,this.towerController.setDragingState(!1),void(this.touchId=null);if(r.isEmpty()){var s=this.dragBuildingController.getBuildingID();r.updateInfo(s),this.towerController.removeBuilding(this.dragBuildingIndex),this.dragBuildingController=null}else r.combineBuilding(this.dragBuildingController)?(this.towerController.removeBuilding(this.dragBuildingIndex),this.combineController.savePacakgeRecord()):this.dragBuildingController.show();this.releaseDrag(),this.dragBuildingController=null,this.towerController.setDragingState(!1)}this.opMode=c,this.touchId=null},onTouchCancel:function(e){this.towerController.onTouchCancel(),this.touchId=null,this.opMode===l?(this.releaseDrag(),this.slotController&&this.slotController.show(),this.slotController=null):this.opMode===u?(this.releaseDrag(),this.dragBuildingController&&this.dragBuildingController.show(),this.dragBuildingController=null,this.towerController.setDragingState(!1)):(this.releaseDrag(),this.dragBuildingController&&(this.dragBuildingController.show(),this.dragBuildingController=null),this.slotController&&(this.slotController.show(),this.slotController=null))}}),cc._RF.pop()},{"../util/UserInfo":"UserInfo","./buildingTipController":"buildingTipController",helper:"helper",objectFactory:"objectFactory",uiController:"uiController"}],scienceSetting:[function(e,t,i){"use strict";cc._RF.push(t,"ab0343H34JMZp2Btz7RsVlF","scienceSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._infoMap={},this.scienceList=[]}return n(e,[{key:"verifyInfo",value:function(e){0===e.id&&(cc.assert(null===item.value),cc.assert(null!=item.value)),cc.assert(0!==e.sciLvlArray.length)}},{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};e.id&&(i.id=Number(e.id),i.name=e.name,i.sprite=e.sprite,i.order=e.order,i.sciLvlArray=[],e.sciLvl.forEach(function(e){var t={};t.level=e.level,t.value=e.value,t.desc=e.desc,t.upDesc=e.upDesc,t.preSci=e.preSci,t.preSciLvl=e.preSciLvl,t.costDiamond=e.costDiamond,i.sciLvlArray.push(t)}),t._infoMap[i.id]=i,t.scienceList.push(i))}),this.scienceList.sort(function(e,t){return e.order-t.order})}},{key:"getScienceLevelInfo",value:function(e,t){var i=this._infoMap[e];if(i){for(var n=0;n<i.sciLvlArray.length;n++){var o=i.sciLvlArray[n];if(o.level===t)return o}return null}console.error("getScienceLevelInfo: id: "+e+" not exist")}},{key:"getScienceInfo",value:function(e){return this._infoMap[e]}},{key:"getScienceList",value:function(){return this.scienceList}}]),e}();t.exports=r,cc._RF.pop()},{}],secretBoxPanelController:[function(e,t,i){"use strict";cc._RF.push(t,"723e2g0lbtM74XrZ4xGNxQb","secretBoxPanelController");var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,a=r.property,c=e("../setting/settingMgr"),l=e("../util/helper"),u=e("./userController"),h=e("../util/constant").SecretBoxState,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boxBtn=null,t.coinNum=null,t.restTimeLabel=null,t.userController=null,t._coin=null,t._restTime=null,t._tickInterval=1,t}return n(t,e),t.prototype.init=function(){var e=c.getSetting("constant");this._secretBoxTime=e.getValue("SECRET_BOX_LIFE");var t=this.userController.getSecretBoxRecord();if(t.state===h.PopUp){var i=l.nowUnixSec();i-t.timeStamp<this._secretBoxTime?(this.boxBtn.active=!0,this._restTime=this._secretBoxTime-(i-t.timeStamp),this.schedule(this.ticker,this._tickInterval),this._coin=t.coin,this.updateUI()):(t.state=h.Inactive,this.userController.setSecretBoxRecord(t))}},t.prototype.popUp=function(){var e=this.userController.getSecretBoxRecord();e.state=h.PopUp,e.timeStamp=l.nowUnixSec();var t=c.getSetting("stages"),i=this.userController.getStage(),n=t.getStageInfo(i);e.coin=n.goldBox,this._coin=e.coin,this.userController.setSecretBoxRecord(e),this.userController.saveUserInfo(),this._restTime=this._secretBoxTime,this.schedule(this.ticker,this._tickInterval),this.updateUI()},t.prototype.updateUI=function(){this.coinNum.string=l.numToStringWithUnit(this._coin)},t.prototype.ticker=function(){if(this._restTime-- >0){var e,t=Math.floor(this._restTime/60),i=this._restTime-60*t;e=i<10?"0"+String(i):String(i),this.restTimeLabel.string=t+" : "+e}else this.setInactive()},t.prototype.setInactive=function(){this.boxBtn.active=!1,this.unschedule(this.ticker);var e=this.userController.getSecretBoxRecord();e.state=h.Inactive,this.userController.setSecretBoxRecord(e),this.userController.saveUserInfo()},t.prototype.getChests=function(){cc.log("buildingPanelController Share"),this.userController.addCoin(this._coin,!0),this.close(),this.setInactive()},t.prototype.close=function(){this.node.x=-9999},o([a(cc.Node)],t.prototype,"boxBtn",void 0),o([a(cc.Label)],t.prototype,"coinNum",void 0),o([a(cc.Label)],t.prototype,"restTimeLabel",void 0),o([a(u)],t.prototype,"userController",void 0),t=o([s],t)}(cc.Component);i.default=d,cc._RF.pop()},{"../setting/settingMgr":"settingMgr","../util/constant":"constant","../util/helper":"helper","./userController":"userController"}],settingMgr:[function(e,t,i){"use strict";cc._RF.push(t,"d8fe5fnPRBIkbenH0LnEOLz","settingMgr");var n=e("enemySetting"),o=e("enemyGroupSetting"),r=e("buildingSetting"),s=e("buildingLevelSetting"),a=e("stagesSetting"),c=e("bulletSetting"),l=e("mapSetting"),u=e("constantSetting"),h=e("scienceSetting"),d=e("textSetting"),g=e("buffSetting"),f={init:function(){var e=this;return new Promise(function(t,i){e.settingSet={enemy:new n,enemyGroup:new o,building:new r,buildingLevel:new s,stages:new a,bullet:new c,map:new l,constant:new u,science:new h,text:new d,buff:new g},e.loadSetting(),t()})},loadSetting:function(){var e=this;cc.loader.loadResDir("json",function(t,i){if(null==t)for(var n=0;n<i.length;n++){var o=null;o=i[n].name.indexOf("map")>=0?e.settingSet.map:e.settingSet[i[n].name],cc.assert(o),o?(o.parse(i[n].json),cc.loader.release(i[n])):cc.loader.release(i[n])}else cc.assert(!1,"loadResDir json error :"+t)})},getSetting:function(e){return this.settingSet[e]}};t.exports=f,cc._RF.pop()},{buffSetting:"buffSetting",buildingLevelSetting:"buildingLevelSetting",buildingSetting:"buildingSetting",bulletSetting:"bulletSetting",constantSetting:"constantSetting",enemyGroupSetting:"enemyGroupSetting",enemySetting:"enemySetting",mapSetting:"mapSetting",scienceSetting:"scienceSetting",stagesSetting:"stagesSetting",textSetting:"textSetting"}],slotController:[function(e,t,i){"use strict";cc._RF.push(t,"7b9c5rhxapC5KFAc41mAksQ","slotController");var n=e("../util/musicPlayer"),o=e("settingMgr"),r=e("helper"),s=e("objectFactory"),a=e("constant").Event;cc.Class({extends:cc.Component,properties:{sprite:cc.Sprite,levelBack:cc.Sprite,levelLabel:cc.Label,shineNode:cc.Node},onLoad:function(){this.node.on(a.CombineFinish,this.combineFinish,this)},combineFinish:function(){this.sprite.enabled=!0,this.combineController.isNewBuilding(this.buildingID)&&this.uiController.showNewBuilding(this.buildingID),n.MusicPlayer.playEffectCombine()},shineIfSameID:function(e){e===this.buildingID&&(this.shineNode.active=!0)},stopShine:function(){this.shineNode.active=!1},init:function(e,t,i,n){this.index=e,this.uiController=t,this.userController=i,this.combineController=n,this.buildingID=0,this.level=0,this.buildingPrefabName=null,this.sprite.node.active=!1;var s=o.getSetting("constant");this.moneyGenInterval=s.getValue("BUILDING_OUTPUT_INTERVAL");var a=r.random(1,1e3*this.moneyGenInterval);this.randomInterval=a/1e3,this.schedule(this.autoMoney,this.randomInterval)},autoMoney:function(){if(this.randomInterval!==this.moneyGenInterval&&(this.randomInterval=this.moneyGenInterval,this.unschedule(this.autoMoney),this.schedule(this.autoMoney,this.moneyGenInterval)),0!==this.buildingID){var e=o.getSetting("buildingLevel").getBuildingLevelInfo(this.level),t=this.node.parent.convertToWorldSpaceAR(this.node.position);t.y+=this.node.height/2;var i=this.moneyGenInterval*e.addGold;i=Math.floor(this.userController.techModifiedCoin(i)),this.uiController.generateAutoMoneyTip(t,i),this.userController.addCoin(i,!1)}},updateInfo:function(e){if(0!==e){var t=o.getSetting("building").getBuildingInfo(e);t?(this.buildingID=e,this.level=t.level,this.buildingPrefabName=t.prefab,this.sprite.node.active=!0,this.buildingAttackRange=t.attRange,this.updateUI()):console.error("slotController updateInfo error buildingInfo not exist id= ",e)}},setIndex:function(e){this.index=e},getIndex:function(){return this.index},getSlotInfo:function(){var e={};return e.index=this.index,e.buildingID=this.buildingID,e.level=this.level,e.buildingPrefabName=this.buildingPrefabName,e.buildingAttackRange=this.buildingAttackRange,e},getSlotBuildingID:function(){return this.buildingID},getSlotBuildingLevel:function(){return this.level},updateUI:function(){0==this.buildingID?(this.sprite.spriteFrame=null,this.levelBack.node.active=!1):(this.setSpriteFrame(this.sprite,this.buildingPrefabName),this.levelBack.node.active=!0,this.levelLabel.string=this.level,this.sprite.node.active=!0)},show:function(){this.sprite.node.opacity=255},hide:function(){this.sprite.node.opacity=130},getSpriteFrame:function(){return this.sprite.spriteFrame},setSpriteFrame:function(e,t){var i="sprite/building/";i+=t.replace("building_","");var n=cc.loader.getRes(i,cc.SpriteFrame);cc.assert(n),e.spriteFrame=n,r.sprResizeByScale(e,100)},reset:function(){this.buildingID=0,this.level=0,this.prefab=0,this.sprite.spriteFrame=null,this.sprite.node.opacity=255,this.updateUI()},isEmpty:function(){return!this.buildingID||0===this.buildingID},replace:function(e){var t=e.getSlotInfo();return 0===this.buildingID&&(this.updateInfo(t.buildingID),!0)},_combine:function(e,t){if(this.buildingID===e){var i=o.getSetting("building").getBuildingInfo(this.buildingID);if(0===i.next)return!1;var n=cc.loader.getRes("effectPrefab/effect_merge",cc.Prefab);cc.assert(n);var r=s.getObject(n),a=cc.Canvas.instance.node;return r.parent=a,r.position=a.convertToNodeSpaceAR(this.node.parent.convertToWorldSpaceAR(this.node.position)),r.getComponent("combineEffectController").init(this.getSpriteFrame(),t,this.node),this.sprite.enabled=!1,this.updateInfo(i.next),!0}return!1},combineBuilding:function(e){var t=e.getBuildingID(),i=e.getSpriteFrame();return this._combine(t,i)},combineSlot:function(e){var t=e.getSlotBuildingID(),i=e.getSpriteFrame();return this._combine(t,i)}}),cc._RF.pop()},{"../util/musicPlayer":"musicPlayer",constant:"constant",helper:"helper",objectFactory:"objectFactory",settingMgr:"settingMgr"}],stagesSetting:[function(e,t,i){"use strict";cc._RF.push(t,"1f623ht3DNC57gDz4XZ8vZO","stagesSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this.stageArray=[],this.stageMap={}}return n(e,[{key:"parse",value:function(e){var t=this;this.stageMap={},cc.assert(Array.isArray(e)),e.forEach(function(e){var i={};e.id&&(t.stageArray.push(i),i.ID=e.id,i.stageMap=e.stage1,i.enemyGroup=e.enemyGroup,i.enemyHpFix=e.enemyHpFix,i.gold=e.gold,i.enemyGroup=e.enemyGroup,i.diamond=e.diamond,i.diamondBox=e.diamondBox,i.getGoldBox=e.getGoldBox,i.goldBox=e.goldBox,i.bgAltas=e.bgAtlas,i.bgSprite=e.bgSprite,t.stageMap[e.id]=e)})}},{key:"getStageEnemyGroup",value:function(e){var t=this.stageMap[e];return t||(cc.log("this.stageMap[stage] stage="+e),cc.assert(!1)),t.enemyGroup}},{key:"getStageInfo",value:function(e){return this.stageMap[e]}}]),e}();t.exports=r,cc._RF.pop()},{}],"state-machine":[function(e,t,i){"use strict";cc._RF.push(t,"c7c80vmbIlHsK12gLlklHy/","state-machine");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,o){"object"===(void 0===i?"undefined":n(i))&&"object"===(void 0===t?"undefined":n(t))?t.exports=o():"function"==typeof define&&define.amd?define("StateMachine",[],o):"object"===(void 0===i?"undefined":n(i))?i.StateMachine=o():e.StateMachine=o()})(void 0,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=5)}([function(e,t,i){e.exports=function(e,t){var i,n,o;for(i=1;i<arguments.length;i++)for(o in n=arguments[i])n.hasOwnProperty(o)&&(e[o]=n[o]);return e}},function(e,t,i){var n=i(0);e.exports={build:function(e,t){var i,o,r,s=t.plugins;for(i=0,o=s.length;i<o;i++)(r=s[i]).methods&&n(e,r.methods),r.properties&&Object.defineProperties(e,r.properties)},hook:function(e,t,i){var n,o,r,s,a=e.config.plugins,c=[e.context];for(i&&(c=c.concat(i)),n=0,o=a.length;n<o;n++)s=a[n],(r=a[n][t])&&r.apply(s,c)}}},function(e,t,i){function n(e){if(0===e.length)return e;var t,i,n=e.split(/[_-]/);if(1===n.length&&n[0][0].toLowerCase()===n[0][0])return e;for(i=n[0].toLowerCase(),t=1;t<n.length;t++)i=i+n[t].charAt(0).toUpperCase()+n[t].substring(1).toLowerCase();return i}n.prepended=function(e,t){return e+(t=n(t))[0].toUpperCase()+t.substring(1)},e.exports=n},function(e,t,i){var o=i(0),r=i(2);function s(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}o(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=r.prepended("onEnter",e),this.lifecycle.onLeave[e]=r.prepended("onLeave",e),this.lifecycle.on[e]=r.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=r.prepended("onBefore",e),this.lifecycle.onAfter[e]=r.prepended("onAfter",e),this.lifecycle.on[e]=r.prepended("on",e)},mapTransition:function(e){var t=e.name,i=e.from,n=e.to;return this.addState(i),"function"!=typeof n&&this.addState(n),this.addTransition(t),this.map[i][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(o({},this.defaults.init,{to:e,active:!0})):"object"===(void 0===e?"undefined":n(e))?this.mapTransition(o({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"===(void 0===e?"undefined":n(e))?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var i,n,o;for(i=0,n=(e=e||[]).length;i<n;i++)"function"==typeof(o=e[i])&&(e[i]=o=o()),o.configure&&o.configure(this);return e},configureTransitions:function(e){var t,i,n,o,r,s=this.defaults.wildcard;for(i=0;i<e.length;i++)for(n=e[i],o=Array.isArray(n.from)?n.from:[n.from||s],r=n.to||s,t=0;t<o.length;t++)this.mapTransition({name:n.name,from:o[t],to:r})},transitionFor:function(e,t){var i=this.defaults.wildcard;return this.map[e][t]||this.map[i][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,i){var n=i(0),o=i(6),r=i(1),s=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}n(a.prototype,{init:function(e){if(n(this.context,this.config.data.apply(this.context,e)),r.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var i=this.config.defaults.wildcard,n=this.config.transitionFor(this.state,e),o=n&&n.to;return"function"==typeof o?o.apply(this.context,t):o===i?this.state:o},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,i,n){var o=this.config.lifecycle,r=this.config.options.observeUnchangedState||t!==i;return i?this.isPending()?this.context.onPendingTransition(e,t,i):(this.config.addState(i),this.beginTransit(),n.unshift({transition:e,from:t,to:i,fsm:this.context}),this.observeEvents([this.observersForEvent(o.onBefore.transition),this.observersForEvent(o.onBefore[e]),r?this.observersForEvent(o.onLeave.state):s,r?this.observersForEvent(o.onLeave[t]):s,this.observersForEvent(o.on.transition),r?["doTransit",[this]]:s,r?this.observersForEvent(o.onEnter.state):s,r?this.observersForEvent(o.onEnter[i]):s,r?this.observersForEvent(o.on[i]):s,this.observersForEvent(o.onAfter.transition),this.observersForEvent(o.onAfter[e]),this.observersForEvent(o.on[e])],n)):this.context.onInvalidTransition(e,t,i)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,i=0,n=this.observers.length,o=[];i<n;i++)(t=this.observers[i])[e]&&o.push(t);return[e,o,!0]},observeEvents:function(e,t,i,n){if(0===e.length)return this.endTransit(void 0===n||n);var o=e[0][0],s=e[0][1],a=e[0][2];if(t[0].event=o,o&&a&&o!==i&&r.hook(this,"lifecycle",t),0===s.length)return e.shift(),this.observeEvents(e,t,o,n);var c=s.shift(),l=c[o].apply(c,t);return l&&"function"==typeof l.then?l.then(this.observeEvents.bind(this,e,t,o)).catch(this.failTransit.bind(this)):!1===l?this.endTransit(!1):this.observeEvents(e,t,o,l)},onInvalidTransition:function(e,t,i){throw new o("transition is invalid in current state",e,t,i,this.state)},onPendingTransition:function(e,t,i){throw new o("transition is invalid while previous transition is still in progress",e,t,i,this.state)}}),e.exports=a},function(e,t,i){var o=i(0),r=i(2),s=i(1),a=i(3),c=i(4),l={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,i){return this._fsm.onInvalidTransition(e,t,i)},onPendingTransition:function(e,t,i){return this._fsm.onPendingTransition(e,t,i)}},u={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function h(e){return d(this||{},e)}function d(e,t){return g(e,new a(t,h)),e._fsm(),e}function g(e,t){if("object"!==(void 0===e?"undefined":n(e))||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,u),o(e,l),o(e,t.methods),t.allTransitions().forEach(function(t){e[r(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new c(this,t),this._fsm.init(arguments)}}h.version="3.0.1",h.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var i=new a(t,h);return g(e.prototype,i),e.prototype._fsm.config=i,e},h.apply=d,h.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=h},function(e,t,i){e.exports=function(e,t,i,n,o){this.message=e,this.transition=t,this.from=i,this.to=n,this.current=o}}])}),cc._RF.pop()},{}],techItemController:[function(e,t,i){"use strict";cc._RF.push(t,"a21d89laKVBW4C1mxprQITS","techItemController");var n=e("../util/musicPlayer"),o=e("settingMgr"),r=e("userController"),s=e("helper");cc.Class({extends:cc.Component,properties:{techName:cc.RichText,level:cc.RichText,cost:cc.Label,desc:cc.Label,nextDesc:cc.Label,techSprite:cc.Sprite,userController:r,upgradeButton:cc.Button,info:cc.Node,text:cc.Label},init:function(e,t,i,n){this.techID=e,this.techLevel=t,this.userController=i,this.uiController=n,this.updateInfo()},updateInfoCondition:function(){this.updateInfo(this.techID,this.techLevel)},updateInfo:function(){var e=o.getSetting("science"),t=e.getScienceInfo(this.techID);if(t){var i=e.getScienceLevelInfo(this.techID,this.techLevel);if(i){this.updateUI(t.name,i.level,i.costDiamond,i.desc,i.upDesc,t.sprite);var n=e.getScienceLevelInfo(this.techID,this.techLevel+1);if(n){if(n.preSci){var r=e.getScienceInfo(n.preSci);if(!r)return;if(this.userController.getTechInfo(n.preSci).level<n.level){this.upgradeButton.interactable=!1,this.info.active=!1,this.text.node.active=!0;var s=o.getSetting("text").getText("10103");return s=(s=s.replace("$[arg1]",r.name)).replace("$[arg2]",n.level),void(this.text.string=s)}this.upgradeButton.interactable=!0,this.info.active=!0,this.text.node.active=!1,this.updateUI(t.name,i.level,i.costDiamond,i.desc,i.upDesc,t.sprite)}}else this.hightestLevel()}}},updateUI:function(e,t,i,n,o,r){this.techName.string=e,this.level.string=t.toString(),this.cost.string=s.numToStringWithUnit(i),this.desc.string=n,this.nextDesc.string=o;var a=cc.loader.getRes("sprite/technology/"+r,cc.SpriteFrame);this.techSprite.spriteFrame=a},upgrade:function(){var e=o.getSetting("science"),t=e.getScienceLevelInfo(this.techID,this.techLevel+1);if(t.preSci&&this.userController.getTechInfo(t.preSci).level<t.level)return;var i=e.getScienceLevelInfo(this.techID,this.techLevel),r=e.getScienceInfo(this.techID);if(this.userController.isDiamondEnough(i.costDiamond)){this.userController.reduceDiamond(i.costDiamond),this.userController.changeTechInfo(this.techID,this.techLevel+1),this.techLevel+=1,this.updateInfo();var s=[];s.push(r.name),s.push(this.techLevel),this.uiController.generateTip("10105",s),n.MusicPlayer.playEffectLvlUp()}else this.uiController.generateTip("10102")},hightestLevel:function(){this.upgradeButton.interactable=!1,this.info.active=!1,this.text.node.active=!0;var e=o.getSetting("text").getText("10104");this.text.string=e}}),cc._RF.pop()},{"../util/musicPlayer":"musicPlayer",helper:"helper",settingMgr:"settingMgr",userController:"userController"}],textSetting:[function(e,t,i){"use strict";cc._RF.push(t,"75e6bViQhxG6ZQjaSOk7xZV","textSetting");var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){o(this,e),this._infoMap={}}return n(e,[{key:"parse",value:function(e){var t=this;Object.values(e).forEach(function(e){var i={};e.id&&(i.id=e.id,i.text=e.text,t._infoMap[i.id]=i)})}},{key:"getText",value:function(e){return this._infoMap[e].text}}]),e}();t.exports=r,cc._RF.pop()},{}],tipController:[function(e,t,i){"use strict";cc._RF.push(t,"0b77cM/ki9BNoQW8QbbVAKi","tipController");var n=e("objectFactory");cc.Class({extends:cc.Component,properties:{text:cc.Label,inTime:cc.Interger=1,inMove:cc.Interger=100,stayTime:cc.Interger=2,outTime:cc.Interger=1,outMove:cc.Interger=200},setText:function(e){this.text.string=e,this.runToastAction()},runToastAction:function(){this.node.stopAllActions();var e=parseInt(this.inTime)/1e3,t=parseInt(this.inMove),i=parseInt(this.stayTime)/1e3,o=parseInt(this.outTime)/1e3,r=parseInt(this.outMove),s=cc.spawn(cc.fadeIn(e),cc.moveBy(e,cc.v2(0,t)).easing(cc.easeCubicActionOut())),a=cc.spawn(cc.fadeOut(o),cc.moveBy(o,cc.v2(0,r)).easing(cc.easeCubicActionIn()));this.node.runAction(cc.sequence(s,cc.delayTime(i),a,cc.callFunc(function(){n.putObject(this.node)}.bind(this))))}}),cc._RF.pop()},{objectFactory:"objectFactory"}],towerController:[function(e,t,i){"use strict";cc._RF.push(t,"c12195I7wtBU4pu6OTPYaHh","towerController");var n=e("../util/musicPlayer"),o=e("Astar"),r=e("settingMgr"),s=e("helper"),a=e("uiController"),c=e("combineController"),l=e("userController"),u=e("constant"),h=u.Event,d=e("objectFactory"),g=u.Direction,f=u.StageState;cc.Class({extends:cc.Component,properties:{uiController:a,userController:l,combineController:c,skySprite:cc.Sprite,groundSprite:cc.Sprite,speedDetect:cc.Node,roadLayer:cc.Node,buildingLayer:cc.Node,enemyLayer:cc.Node,bulletLayer:cc.Node,mapNode:cc.Node,roadTilePrefab:cc.Prefab},tileMapGridCoordToMapNodePos:function(e){var t=cc.v2(e.x+.5,e.y+.5),i=t.x*this.tileSize.width-this.tileMapSize.width/2,n=t.y*this.tileSize.height-this.tileMapSize.height/2;return cc.v2(i,n)},mapNodePosToTileMapGridCoord:function(e){var t=e.x+this.tileMapSize.width/2,i=e.y+this.tileMapSize.height/2,n=Math.floor(t/this.tileSize.width),o=Math.floor(i/this.tileSize.height);return cc.v2(n,o)},mapNodePosToWorldSpaceAR:function(e){return this.mapNode.convertToWorldSpaceAR(e)},tileMapGridCoordToGridIndex:function(e){return Math.floor(e.y*this.mapSizeByGrid.width+e.x)},gridIndexToTileMapGridCoord:function(e){var t=this.mapSizeByGrid.width,i=Math.floor(e%t),n=Math.floor(e/t);return cc.v2(i,n)},touchPosToTileGridIndex:function(e){var t=this.mapNode.convertToNodeSpaceAR(e),i=this.mapNodePosToTileMapGridCoord(t);return this.tileMapGridCoordToGridIndex(i)},onLoad:function(){this.gridMap={},d.buildObjectPool(this.roadTilePrefab,200)},initTechAttr:function(){var e=this.userController.getTechInfo(7),t=this.userController.getTechInfo(6),i=r.getSetting("science"),n=i.getScienceLevelInfo(e.id,e.level);this.maxBuildingNum=this.baseBuildingNum+n.value,this.uiController.updateTowerBuildingNum(Object.keys(this.gridMap).length,this.maxBuildingNum);var o=i.getScienceLevelInfo(t.id,t.level);Object.values(this.gridMap).forEach(function(e){e.buildingController.setAttackHurtRate(1+o.value)})},init:function(e,t){var i=r.getSetting("constant"),s=r.getSetting("stages"),a=r.getSetting("map"),c=r.getSetting("enemyGroup");this.stage=e,this.stageSettingInfo=s.getStageInfo(this.stage),this.baseBuildingNum=i.getValue("BUILDING_NUM_MAX"),this.maxBuildingNum=this.baseBuildingNum,this.uiController.updateStage(this.stage),this.mapName=this.stageSettingInfo.stageMap;var l=cc.loader.getRes("map/"+this.mapName,cc.tileMapAsset);cc.assert(l),this.mapNode.getComponent(cc.TiledMap).tmxAsset=l,this.enemyOnRoad=[],this.enemyReach=[],this.bulletMap=[],this.uiController.updateTowerBuildingNum(Object.keys(this.gridMap).length,this.maxBuildingNum),this.defending=!1,this.isDragingState=!1,this._timeCounter=0,this._lastGenMonsterTime=0,this.astar=new o,this.tileMapSize=cc.size(this.mapNode.width,this.mapNode.height),this.tileSize=a.getTileSize(this.mapName),this.mapSizeByGrid=a.getMapSize(this.mapName),this.enemySpwanArray=c.getEnemyGroupArray(this.stageSettingInfo.enemyGroup),this.exit=a.getExit(this.mapName),this.roadMap=a.getRoadMap(this.mapName),this.obstacleMap=a.getObstacleMap(this.mapName),this.bornTileSprite=cc.loader.getRes("sprite/preload/icon_born",cc.SpriteFrame),this.exitTileNormalFrame=cc.loader.getRes("sprite/preload/icon_dspr",cc.SpriteFrame),this.exitTileDestroyFrame=cc.loader.getRes("sprite/preload/icon_dspr2",cc.SpriteFrame),cc.assert(this.bornTileSprite&&this.exitTileNormalFrame&&this.exitTileDestroyFrame);var u=cc.loader.getRes(this.stageSettingInfo.bgAtlas,cc.SpriteAtlas).getSpriteFrame(this.stageSettingInfo.bgSprite);if(this.groundSprite.spriteFrame=u,this.buildRoad(this.roadMap),this.buildObstacle(this.obstacleMap),this.initTechAttr(),this.initEvent(),t){for(var h=r.getSetting("building"),d=0;d<t.length;d++){var g=t[d],p=h.getBuildingInfo(g.buildingID),v=cc.loader.getRes("buildingPrefab/"+p.prefab,cc.Prefab),m=cc.instantiate(v);m.position=g.position,m.parent=this.buildingLayer;var b=m.getComponent("buildingController");b.hideBase();var y=this.tileMapGridCoordToGridIndex(this.mapNodePosToTileMapGridCoord(m.position));this.gridMap[y]={},this.gridMap[y].buildingController=b,this.gridMap[y].isValid=!0,b.init(g.buildingID,this);var C=m.getComponent(cc.BoxCollider),S=m.position;S=S.addSelf(C.offset);var I=cc.v2(S.x-C.size.width/2,S.y+C.size.height/2),B=cc.v2(S.x-C.size.width/2,S.y-C.size.height/2),T=cc.v2(S.x+C.size.width/2,S.y+C.size.height/2),_=this.mapNodePosToTileMapGridCoord(I),x=this.mapNodePosToTileMapGridCoord(T),R=this.mapNodePosToTileMapGridCoord(B),P=_.x,M=x.x,w=_.y,N=R.y;e:for(var L=w;L<=N;L++)for(var A=P;A<=M;A++){var F=Math.floor(L*this.mapSizeByGrid.width+A);if(this.isRoad(F)||this.isObstacle(F)){b.showRedBase(),this.gridMap[y].isValid=!1,b.showWarning();break e}}}this.uiController.updateTowerBuildingNum(Object.keys(this.gridMap).length,this.maxBuildingNum),this.uiController.showStageTip(this.stage,f.Prepare),n.MusicPlayer.playPrepareBGM()}},initEvent:function(){this.node.on(h.TechInfoChange,this.techInfoChange,this)},techInfoChange:function(e,t){var i=r.getSetting("science");if(5===e){var n=i.getScienceLevelInfo(e,t);Object.values(this.gridMap).forEach(function(e){e.buildingController.setAttackHurtRate(1+n.value)})}else if(7===e){var o=i.getScienceLevelInfo(e,t);this.maxBuildingNum=this.baseBuildingNum+o.value,this.uiController.updateTowerBuildingNum(Object.keys(this.gridMap).length,this.maxBuildingNum)}},buildRoad:function(e){for(var t=this.mapSizeByGrid.width,i=this.mapSizeByGrid.height,n=r.getSetting("map"),o=0;o<i;o++)for(var s=0;s<t;s++)if(0!==e[o][s]){var a=d.getObject(this.roadTilePrefab),c=a.getComponent(cc.Sprite),l=s+o*t;n.isEntranceByIndex(this.mapName,l)?c.spriteFrame=this.bornTileSprite:s===this.exit.x&&o===this.exit.y?(c.spriteFrame=this.exitTileNormalFrame,this.exitTileSpriteComp=c):c.spriteFrame=null,a.parent=this.roadLayer;var u=this.tileMapGridCoordToMapNodePos(cc.v2(s,o));a.position=u}},buildObstacle:function(e){for(var t=this.mapSizeByGrid.width,i=this.mapSizeByGrid.height,n=0;n<i;n++)for(var o=0;o<t;o++)if(0!==e[n][o]){var r=d.getObject(this.roadTilePrefab);r.getComponent(cc.Sprite).spriteFrame=null,r.parent=this.roadLayer;var s=this.tileMapGridCoordToMapNodePos(cc.v2(o,n));r.position=s}},buildMap:function(e){for(var t=this.mapSizeByGrid.width,i=this.mapSizeByGrid.height,n=0;n<i;n++)for(var o=0;o<t;o++){var r=cc.instantiate(this.roadTilePrefab);r.parent=this.buildingLayer;var s=this.tileMapGridCoordToMapNodePos(cc.v2(o,n));r.position=s}},isDefending:function(){return this.defending},startDefend:function(){if(0!==Object.keys(this.gridMap).length){var e=!0,t=!0,i=!1,o=void 0;try{for(var r,s=Object.values(this.gridMap)[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var a=r.value;a.isValid||(a.buildingController.playWarningAnimation(),e=!1)}}catch(e){i=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw o}}if(!e)return this.uiController.generateTip("10305"),void n.MusicPlayer.playEffectWrong();this.defending=!0,this.schedule(this.enemySpawn,.1),this.enemySpawn(),this.uiController.showStartButton(!1),this.uiController.showStageTip(this.stage,f.Fight),Object.values(this.gridMap).forEach(function(e){e.buildingController.startAttack()}),n.MusicPlayer.playEffectStart(),n.MusicPlayer.playFightBGM()}else this.uiController.generateTip("10304")},stopDefend:function(){this.defending=!1,this.unschedule(this.enemySpawn),this.enemyOnRoad.forEach(function(e){e.stopMove()}),Object.values(this.gridMap).forEach(function(e){e.buildingController.stopAttack()})},resumeDefend:function(){this.defending=!0,this.schedule(this.enemySpawn,.1),this.enemyOnRoad.forEach(function(e){e.resumeMove()}),Object.values(this.gridMap).forEach(function(e){e.buildingController.startAttack()})},enemySpawn:function(){var e=this;this._timeCounter=this._timeCounter+100,this.enemySpwanArray.forEach(function(t){if(t.time<e._timeCounter&&t.time>e._lastGenMonsterTime){var i=r.getSetting("map").getEntrance(e.mapName,t.position);if(!i)return;for(var n=e.astar.getPath(e.roadMap,i,e.exit),o=[],a=g.Right,c=0;c<n.length;c++){var l={};l.direction=g.Right,l.position=e.tileMapGridCoordToMapNodePos(n[c].getPosition()),o.push(l),n[c+1]?n[c+1].position.x>n[c].position.x?l.direction=g.Right:n[c+1].position.x<n[c].position.x?l.direction=g.Left:l.direction=a:l.direction=a;var u=s.random(-15,16),h=s.random(-15,16);l.position.x+=u,l.position.y+=h,a=l.direction}var f=r.getSetting("enemy").getEnemyInfo(t.enemy),p=cc.loader.getRes("rolePrefab/"+f.prefab,cc.Prefab);cc.assert(p);var v=d.getObject(p);v.parent=e.enemyLayer,v.position=o[0].position.add(o[0].position.sub(o[1].position));var m=s.genID(),b=v.getComponent("enemyController");b.init(m,t.enemy,o,e.stageSettingInfo.enemyHpFix,e),b.startMove(),e.enemyOnRoad.push(b),e._lastGenMonsterTime=e._timeCounter}})},isTowerArea:function(e){var t=this.mapNode.convertToNodeSpaceAR(e);return this.mapNode.getBoundingBox().contains(t)},isRoad:function(e){var t=this.gridIndexToTileMapGridCoord(e);return!(!this.roadMap[t.y]||!this.roadMap[t.y][t.x]||0===this.roadMap[t.y][t.x])},isObstacle:function(e){var t=this.gridIndexToTileMapGridCoord(e);return!(!this.obstacleMap[t.y]||!this.obstacleMap[t.y][t.x]||0===this.obstacleMap[t.y][t.x])},isTouchBuildingExceptIndex:function(e,t){if(this.isDefending())return!0;var i=this.buildingLayer.convertToNodeSpaceAR(e),n=!0,o=!1,r=void 0;try{for(var s,a=Object.keys(this.gridMap)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value;if(t!==c)if(this.gridMap[c].buildingController.node.getBoundingBox().contains(i))return!0}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return!1},isTouchBuilding:function(e){if(this.isDefending())return null;var t=this.buildingLayer.convertToNodeSpaceAR(e),i=!0,n=!1,o=void 0;try{for(var r,s=Object.keys(this.gridMap)[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,c=this.gridMap[a];if(c.buildingController.node.getBoundingBox().contains(t)){var l={};return l.buildingController=c.buildingController,l.index=a,l}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return null},removeBuilding:function(e){var t=this.gridMap[e].buildingController;t&&(t.node.destroy(),delete this.gridMap[e],this.uiController.updateTowerBuildingNum(Object.keys(this.gridMap).length,this.maxBuildingNum),this.saveBuildingRecord())},setDragingState:function(e){this.isDragingState=e},placeBuilding:function(e,t,i){if(!this.isDefending()){var o=t.getComponent("buildingController");if(o.isCanPlace()){o.hideAttackRange();var r=this.touchPosToTileGridIndex(i);if(this.gridMap[r])return!1;var s=Object.keys(this.gridMap).length;if(this.isDragingState&&s--,this.maxBuildingNum==s)return this.uiController.generateTip("10302"),!1;if(this.isRoad(r))return this.uiController.generateTip("10301"),!1;var a=cc.instantiate(t);a.position=t.position,a.parent=this.buildingLayer;var c=a.getComponent("buildingController");return c.hideBase(),c.init(e,this),this.gridMap[r]={},this.gridMap[r].buildingController=c,this.gridMap[r].isValid=!0,c.hideWarning(),this.uiController.updateTowerBuildingNum(s+1,this.maxBuildingNum),n.MusicPlayer.playEffectPlace(),this.saveBuildingRecord(),!0}this.uiController.generateTip("10301")}},exitTileFrameReset:function(){this.exitTileSpriteComp.spriteFrame=this.exitTileNormalFrame},onEnemyReach:function(e){if(this.enemyReach.push(e),this.exitTileSpriteComp.spriteFrame=this.exitTileDestroyFrame,this.unschedule(this.exitTileFrameReset),this.schedule(this.exitTileFrameReset,1),this.enemyOnRoad=this.enemyOnRoad.filter(function(t){return t.id!==e.id}),!e.isFeedFull())return this.stopDefend(),void this.uiController.lose(e);e.leave(),0===this.enemyOnRoad.length&&this.uiController.win(this.stage)},onBulletHit:function(e){delete this.bulletMap[e.id]},saveBuildingRecord:function(){var e=this,t=[];Object.values(this.gridMap).forEach(function(i){var n={};n.buildingID=i.buildingController.getBuildingID(),n.position=i.buildingController.node.position,t.push(n),e.userController.setTowerBuildingRecord(t)})},clearBuilding:function(){Object.values(this.gridMap).forEach(function(e){e.buildingController.node.destroy()}),this.gridMap={}},clearRoad:function(){for(var e=this.roadLayer.children;0<e.length;)d.putObject(e[0])},clearBattle:function(){this._timeCounter=0,this._lastGenMonsterTime=0,Object.values(this.bulletMap).forEach(function(e){d.putObject(e.node)}),this.enemyOnRoad.forEach(function(e){d.putObject(e.node)}),this.enemyReach.forEach(function(e){d.putObject(e.node)}),this.enemyOnRoad=[],this.enemyReach=[],this.bulletMap={}},nextStage:function(){this.saveBuildingRecord(),this.clearBattle(),this.clearRoad(),this.clearBuilding();var e=this.stageSettingInfo,t=Math.floor(this.userController.techModifiedCoin(e.gold));this.userController.addCoin(t),this.userController.addDiamond(e.diamond),this.stopDefend(),this.uiController.showStartButton(!0),this.uiController.hideResultWindow();var i=this.stage+1;if(this.userController.setStage(i),this.init(i,this.userController.getTowerBuildingRecord()),e.getGoldBox){var n=this.userController.getSecretBoxRecord();n.state===u.SecretBoxState.Inactive&&(n.state=u.SecretBoxState.Active,this.userController.setSecretBoxRecord(n))}},backToMain:function(){this.clearBattle(),this.stopDefend(),this.uiController.showStartButton(!0),this.uiController.hideResultWindow(),n.MusicPlayer.playEffectLose(),n.MusicPlayer.playPrepareBGM()},onTouchStart:function(e){this.isDefending()&&(this.speedDetect.active=!0,this.speedDetect.position=this.buildingLayer.convertToNodeSpaceAR(e))},onTouchMove:function(e){this.isDefending()&&(this.speedDetect.position=this.buildingLayer.convertToNodeSpaceAR(e))},onTouchEnd:function(){this.isDefending()&&(this.speedDetect.active=!1)},onTouchCancel:function(){this.isDefending()&&(this.speedDetect.active=!1)}}),cc._RF.pop()},{"../util/musicPlayer":"musicPlayer",Astar:"Astar",combineController:"combineController",constant:"constant",helper:"helper",objectFactory:"objectFactory",settingMgr:"settingMgr",uiController:"uiController",userController:"userController"}],uiController:[function(e,t,i){"use strict";cc._RF.push(t,"3bb22JEOIlG54aiYSMau1hB","uiController");var n=e("../util/musicPlayer"),o=e("settingMgr"),r=e("objectFactory"),s=e("constant"),a=e("helper"),c=s.StageState;cc.Class({extends:cc.Component,properties:{coinNumLabel:cc.Label,coinSpeedNumLabel:cc.Label,diamondNumLabel:cc.Label,stageLabel:cc.Label,startButton:cc.Node,oven:cc.Node,towerBuildingNum:cc.Label,winPanel:cc.Node,losePanel:cc.Node,tipPrefab:cc.Prefab,autoMoneyPrefab:cc.Prefab,offlinePanel:cc.Node,candyBagPanel:cc.Node,secretBoxBtn:cc.Node,secretBoxPanel:cc.Node,tipLayer:cc.Node,newBuildingPanel:cc.Node,stageTip:cc.Node,stageTipNum:cc.Label,stageTipState:cc.Label},onLoad:function(){r.buildObjectPool(this.tipPrefab,5),r.buildObjectPool(this.autoMoneyPrefab,20)},start:function(){this.secretBoxPanel.getComponent("secretBoxPanelController").init()},showCandyBagPanel:function(){this.candyBagPanel.active=!0},showOfflinePanel:function(e,t){this.offlinePanel.active=!0,this.offlinePanel.getComponent("offlinePanelController").init(e,t)},destroyOfflinePanel:function(){this.offlinePanel.destroy()},hideResultWindow:function(){this.winPanel.active=!1,this.losePanel.active=!1},showNewBuilding:function(e){this.newBuildingPanel.active=!0,this.newBuildingPanel.getComponent("buildingPanelController").updateInfo(e)},showOven:function(e){e&&(this.showStartButton(!1),this.oven.active=e),this.oven.active=e},showSecretBox:function(e){e===s.SecretBoxState.Active&&(this.secretBoxBtn.active=!0,this.secretBoxPanel.getComponent("secretBoxPanelController").popUp());this.secretBoxPanel.x=0},win:function(e){this.winPanel.active=!0,this.winPanel.getComponent("winPanelController").updateInfo(e),n.MusicPlayer.playEffectWin()},lose:function(e){this.losePanel.active=!0,this.losePanel.getComponent("losePanelController").init(e)},updateCoin:function(e){this.coinNumLabel.string=a.numToStringWithUnit(e)},updateDiamond:function(e){this.diamondNumLabel.string=a.numToStringWithUnit(e)},updateCoinSpeed:function(e){e=Math.floor(e),this.coinSpeedNumLabel.string=a.numToStringWithUnit(e)},updateStage:function(e){this.stageLabel.string=e},showStartButton:function(e){if(!e){var t=cc.sequence(cc.spawn(cc.scaleBy(.8,1.5).easing(cc.easeCubicActionOut()),cc.fadeOut(.8).easing(cc.easeCubicActionOut())),cc.callFunc(function(){this.startButton.scale=1,this.startButton.opacity=255,this.startButton.active=!1},this));return t.easing(cc.easeCubicActionOut()),void this.startButton.runAction(t)}this.startButton.active=e},updateTowerBuildingNum:function(e,t){var i=e+"/"+t;this.towerBuildingNum.string=i},generateTip:function(e,t){t=t||[];var i=o.getSetting("text").getText(e),n=r.getObject(this.tipPrefab);n.parent=this.node,n.position=cc.v2(0,0);for(var s=0;s<t.length;s++)i=i.replace("$[arg"+(s+1)+"]",t[s]);n.getComponent("tipController").setText(i)},generateAutoMoneyTip:function(e,t){var i=r.getObject(this.autoMoneyPrefab);i.parent=this.tipLayer,i.position=this.tipLayer.convertToNodeSpaceAR(e),i.getComponent("tipController").setText(a.numToStringWithUnit(t))},showStageTip:function(e,t){var i=this;this.stageTipNum.string=e.toString();var n=o.getSetting("text");t===c.Prepare?this.stageTipState.string=n.getText(10306):t===c.Fight&&(this.stageTipState.string=n.getText(10307)),this.stageTip.stopAllActions(),this.stageTip.x=0,this.stageTip.scale=.7,this.stageTip.runAction(cc.sequence(cc.spawn(cc.fadeIn(.5),cc.scaleTo(.5,1).easing(cc.easeBackOut())),cc.delayTime(2.5),cc.fadeOut(1),cc.callFunc(function(){i.stageTip.x=-999})))}}),cc._RF.pop()},{"../util/musicPlayer":"musicPlayer",constant:"constant",helper:"helper",objectFactory:"objectFactory",settingMgr:"settingMgr"}],userController:[function(e,t,i){"use strict";cc._RF.push(t,"a993byD/oRBG5EuKbo+Cxn2","userController");var n=e("../util/UserInfo"),o=e("uiController"),r=e("settingMgr"),s=e("constant"),a=e("helper"),c=s.Event;cc.Class({extends:cc.Component,properties:{uiController:o,towerNode:cc.Node,combineNode:cc.Node,custom:cc.Boolean=!1,reset:cc.Boolean=!1,coin:cc.Integer,diamond:cc.Integer,stage:cc.Integer},onLoad:function(){this.schedule(this.saveUserInfo,5)},init:function(){var e=n.getSingleton(),t=this.getUserFromCocos();if(e.setUserInfo(t.data.userInfo._userInfo),0!==t.data.lastOnlineTime){var i=r.getSetting("constant").getValue("OFFLINE_REWARD_TIME_MAX"),o=a.nowUnixSec(),s=Math.floor(o-t.data.lastOnlineTime);s<0&&(s=0),s>=i&&(s=i);var c=this.getBuildingProfitPerSec();this.offlineProfit=Math.floor(this.techModifiedCoin(s*c)),0!==this.offlineProfit&&this.uiController.showOfflinePanel(this.offlineProfit,s),a.isSameDay(o,t.data.lastOnlineTime)||this.initNewDay()}this.custom&&(cc.log("custom "+JSON.stringify(t.data.userInfo._userInfo)),e.setStage(parseInt(this.stage)),e.setCoin(parseInt(this.coin)),e.setDiamond(parseInt(this.diamond)),this.saveUserInfo()),this.reset&&(e.initDefault(),this.saveUserInfo(!0)),this.uiController.updateStage(e.getStage()),this.uiController.updateCoin(e.getCoin()),this.uiController.updateDiamond(e.getDiamond()),this.uiController.updateCoinSpeed(this.getBuildingProfitPerSec())},initNewDay:function(){var e=n.getSingleton(),t=e.getSecretBoxRecord();t.state===s.SecretBoxState.Inactive&&(t.state=s.SecretBoxState.Active,e.setSecretBoxRecord(t)),this.saveUserInfo()},getStage:function(){return n.getSingleton().getStage()},setStage:function(e){e=e||1;var t=n.getSingleton();t.setStage(e),this.combineNode.emit(c.StageChange,t),this.saveUserInfo()},getCoin:function(){return n.getSingleton().getCoin()},setCoin:function(e){var t=n.getSingleton();t.setCoin(e),this.uiController.updateCoin(t.getCoin()),this.saveUserInfo()},isCoinEnough:function(e){return n.getSingleton().getCoin()>=e},getDiamond:function(){return n.getSingleton().getDiamond()},setDiamond:function(e){var t=n.getSingleton();t.setDiamond(e),this.saveUserInfo(),this.uiController.updateDiamond(t.getDiamond())},getCandyBagRecord:function(){return n.getSingleton().getCandyBagRecord()},setCandyBagRecord:function(e){n.getSingleton().setCandyBagRecord(e),this.saveUserInfo()},getSecretBoxRecord:function(){return n.getSingleton().getSecretBoxRecord()},setSecretBoxRecord:function(e){n.getSingleton().setSecretBoxRecord(e),this.saveUserInfo()},getMaxBuildingLevel:function(){return n.getSingleton().getMaxBuildingLevel()},setMaxBuildingLevel:function(e){n.getSingleton().setMaxBuildingLevel(e),this.saveUserInfo()},setTowerBuildingRecord:function(e){n.getSingleton().setTowerBuildingRecord(e),this.saveUserInfo()},getTowerBuildingRecord:function(){return n.getSingleton().getTowerBuildingRecord()},setPackageRecord:function(e){n.getSingleton().setPackageRecord(e),this.saveUserInfo(),this.uiController.updateCoinSpeed(this.getBuildingProfitPerSec())},getPackageRecord:function(){return n.getSingleton().getPackageRecord()},setUserInfo:function(e){n.getSingleton().setUserInfo(e),this.saveUserInfo()},getUserInfo:function(){return n.getSingleton()},getTechInfoList:function(){return n.getSingleton().getTechInfoList()},getTechInfo:function(e){return n.getSingleton().getTechInfo(e)},getBuyRecord:function(e){return n.getSingleton().getBuyRecord(e)},getBuildingProfitPerSec:function(){for(var e=0,t=n.getSingleton(),i=t.getPackageRecord(),o=t.getTowerBuildingRecord(),r=0;r<i.length;r++){var s=i[r].buildingID;s>0&&(e+=this.getOneBuildingProfit(s))}for(var a=0;a<o.length;a++){var c=o[a].buildingID;e+=this.getOneBuildingProfit(c)}return e=this.techModifiedCoin(e)},getOneBuildingProfit:function(e){var t=r.getSetting("building"),i=r.getSetting("buildingLevel"),n=t.getBuildingInfo(e).level;return i.getBuildingLevelInfo(n).addGold},getOfflineProfitDouble:function(){this.addCoin(2*this.offlineProfit,!0),this.uiController.destroyOfflinePanel()},getOfflineProfit:function(){this.addCoin(this.offlineProfit,!0),this.uiController.destroyOfflinePanel()},changeTechInfo:function(e,t){var i=n.getSingleton().getTechInfo(e);i.level!==t&&(i.level=t,this.towerNode.emit(c.TechInfoChange,e,t),this.combineNode.emit(c.TechInfoChange,e,t))},addBuyRecord:function(e,t){var i=n.getSingleton(),o=i.getBuyRecord(e);i.setBuyRecord(e,o.num+t)},addCoin:function(e,t){var i=n.getSingleton(),o=!0;!1===t&&(o=!1);var s=r.getSetting("constant").getValue("COIN_MAX"),c=i.getCoin();if(c+e>s?i.setCoin(s):i.setCoin(c+e),this.uiController.updateCoin(i.getCoin()),this.saveUserInfo(),o){var l=[];l.push(a.numToStringWithUnit(e)),this.uiController.generateTip("10002",l)}},reduceCoin:function(e){var t=n.getSingleton();if(this.isCoinEnough(e)){var i=t.getCoin();return i-=e,t.setCoin(i),this.uiController.updateCoin(t.getCoin()),this.saveUserInfo(),!0}return!1},techModifiedCoin:function(e){var t=r.getSetting("science"),i=this.getTechInfo(6);return e*=1+t.getScienceLevelInfo(i.id,i.level).value},reduceDiamond:function(e){var t=n.getSingleton();if(this.isDiamondEnough(e)){var i=t.getDiamond();return i-=e,t.setCoin(i),this.uiController.updateDiamond(t.getDiamond()),this.saveUserInfo(),!0}return!1},isDiamondEnough:function(e){return n.getSingleton().getDiamond()>=e},addDiamond:function(e,t){var i=!0;null!==t&&(i=t);var o=r.getSetting("constant").getValue("DIAMOND_MAX"),s=n.getSingleton();if(s.getDiamond()+e>o?s.setDiamond(o):s.setDiamond(s.getDiamond()+e),this.uiController.updateDiamond(s.getDiamond()),this.saveUserInfo(),i){var a=[];a.push(e),this.uiController.generateTip("10001",a)}},saveUserInfo:function(e){e=e||!1,this.saveUserToCocos(e)},getUserFromWeChat:function(){var e=this;wx.cloud.database({env:s.WXCloudEnv}).collection(s.UserInfoStorgeKey).where({openid:"user-open-id"}).get({success:function(t){var i=n.getSingleton();if(t.data.length>0){var o=e.adjustUserInfo(t.data[0]),r=JSON.parse(o);i.setUserInfo(r.data.userInfo),cc.log(JSON.stringify(i.getUserInfo())),cc.log(r.data.lastOnlineTime)}else{var s=e.adjustUserInfo(""),a=JSON.parse(s);n.getSingleton().setUserInfo(a.data.userInfo),cc.log(JSON.stringify(n.getSingleton().getUserInfo())),cc.log(a.data.lastOnlineTime),resolve()}}})},saveUserToWeChat:function(){var e=JSON.stringify(n.getSingleton().getUserInfo()),t=wx.cloud.database({env:s.WXCloudEnv});t.collection(s.UserInfoStorgeKey).where({openid:"user-open-id"}).get({success:function(i){i.data.length>0?t.collection(s.UserInfoStorgeKey).doc(i.data[0].openid).set({data:{lastOnlineTime:t.serverDate(),userInfo:e}}):t.collection(s.UserInfoStorgeKey).add({openid:"user-open-id",data:{lastOnlineTime:t.serverDate(),userInfo:e}})}})},getUserFromCocos:function(){var e=cc.sys.localStorage.getItem(s.UserInfoStorgeKey);e=this.adjustUserInfo(e);var t=JSON.parse(e);return cc.log("record: "+JSON.stringify(t)),t},saveUserToCocos:function(e){var t=a.nowUnixSec();e&&(t=0);var i={openid:"user-open-id",version:.2,data:{lastOnlineTime:t,userInfo:n.getSingleton()}},o=JSON.stringify(i);cc.sys.localStorage.setItem(s.UserInfoStorgeKey,o)},adjustUserInfo:function(e){var t=JSON.parse(e);return t&&t.version&&.2===t.version?e:(cc.log("adjustUserInfo"),this.saveUserInfo(),cc.sys.localStorage.getItem(s.UserInfoStorgeKey))}}),cc._RF.pop()},{"../util/UserInfo":"UserInfo",constant:"constant",helper:"helper",settingMgr:"settingMgr",uiController:"uiController"}],winPanelController:[function(e,t,i){"use strict";cc._RF.push(t,"005edWkkP1O/LYfUF9rcLvo","winPanelController");var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,a=r.property,c=e("../setting/settingMgr"),l=e("../util/helper"),u=e("./userController"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stageLabel=null,t.rewardCoinLabel=null,t.rewardCandyLabel=null,t.userController=null,t}return n(t,e),t.prototype.updateInfo=function(e){this.stageLabel.string=e.toString();var t=c.getSetting("stages").getStageInfo(e),i=Math.floor(this.userController.techModifiedCoin(t.gold));this.rewardCoinLabel.string=l.numToStringWithUnit(i),this.rewardCandyLabel.string=l.numToStringWithUnit(t.diamond)},t.prototype.share=function(){cc.log("WinPanelController Share")},t.prototype.close=function(){this.node.active=!1},o([a(cc.Label)],t.prototype,"stageLabel",void 0),o([a(cc.Label)],t.prototype,"rewardCoinLabel",void 0),o([a(cc.Label)],t.prototype,"rewardCandyLabel",void 0),o([a(u)],t.prototype,"userController",void 0),t=o([s],t)}(cc.Component);i.default=h,cc._RF.pop()},{"../setting/settingMgr":"settingMgr","../util/helper":"helper","./userController":"userController"}]},{},["buildingController","buildingPanelController","buildingTipController","bulletController","candyBagController","combineController","combineEffectController","enemyController","enemyStateBarController","explodeController","guideController","losePanelController","offlinePanelController","operationController","secretBoxPanelController","slotController","techItemController","tipController","towerController","uiController","userController","winPanelController","gameManager","gameScene","buffSetting","buildingLevelSetting","buildingSetting","bulletSetting","constantSetting","enemyGroupSetting","enemySetting","mapSetting","scienceSetting","settingMgr","stagesSetting","textSetting","Astar","UserInfo","constant","helper","modalUI","musicPlayer","objectFactory","onAnimationFinish","state-machine"]);